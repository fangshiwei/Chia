window.Store.addService("Util",function(e,t){function o(){var e=this;e.logined=!1,e.info={}}return o.prototype.init=function(){},o.prototype.pvPage=function(){try{MLTrackerz.track({type:"pageview",path:window.location.href})}catch(e){}},o.prototype.pvEvent=function(e){try{MLTrackerz.track({type:"event",action:e})}catch(t){}},o.prototype.pvBusiness=function(e){try{MLTrackerz.track(e)}catch(t){}},o.prototype.SMpvEvent=function(e,t){try{_smq.push(["custom",e,t])}catch(o){}},o.prototype.SMpvOrder=function(e,t,o){try{_smq.push(["custom","提交订单",t,o,e])}catch(i){}},o.prototype.SMpvPayment=function(e,t,o){try{_smq.push(["custom","成交订单",t,o,e])}catch(i){}},o.prototype.openLive800Diag=function(){var e=decodeURIComponent(arguments[0]||"http://chat10.live800.com/live800/chatClient/chatbox.jsp?companyID=376704&lan=zh&configID=185120&jid=4594069570"),t=arguments[1]||"_blank",o=arguments[2]||800,i=arguments[3]||600,r="directories=no, titlebar=no, toolbar=no, location=no, status=no, menubar=no, scrollbars=no, resizable=no, top=200,left=200, width= "+o+", height="+i,a=arguments[4]||!0;window.open(e,t,r,a)},o.prototype.toggleWeixinCode=function(t){var o=e(t),i=o.find(".qrcode");i.is(":hidden")&&(o.addClass("hold"),i.show().animate({opacity:"1"},200,function(){e(document).one("click",function(){i.animate({opacity:"0"},200,function(){o.removeClass("hold"),i.hide()})})}))},o.prototype.toggleLanguageMenu=function(t){var o=(e(t),e(".language-switch"));o.toggleClass("active");var i=function(t){var r=e(t.target);r.closest(".language-switch").is(".language-switch")||(o.removeClass("active"),e(document).off("click",i))};return e(document).on("click",i),!1},o.prototype.errorLog=function(e){return mainService.ajax({url:"Log/Write",data:e,error:function(){return!1}})},o.prototype.nutsStatus=function(){return t.proxyDefer("购买坚果手机")},o.prototype.getTime=function(){return mainService.ajax({url:"http://www.smartisan.com/get/curtime",dataType:"jsonp",success:function(e,t,o){return e.curtime}})},new o}(jQuery,window.Store)),window.Store.addView("SubNav",function(){return Backbone.View.extend({el:"#sub-nav",initialize:function(){},events:{"click .js-toggle-nav":"openMenu"},render:function(e,t){var o=this;o.$fixPanel=o.$(".sub-nav-fix-panel"),o.isOpenMenu=!1,o.openType="",o.insertNavGoods()},insertNavGoods:function(){var e=this,t=ct.get("tempSubNavGoodsItem",!0),o=e.navGoodsData();e.$(".js-nav-goods-panel").html(ct.compile(t,{navGoods:o}))},selectCategory:function(e){var t=this;t.$(".js-sub-nav-list li").toggleClass("selected",!1),t.$('.js-sub-nav-list li[data-category="'+e+'"]').toggleClass("selected",!0)},toggleStyle:function(e){var t=this;e=e||"",t.$el.removeClass().addClass("layout-sub-header "+e)},openMenu:function(e){var t=this,o=$(e.currentTarget),i=$(".js-nav-zoom-panel"),r=o.data("type"),a=o.data("close");return i.length?void i.find(".js-banner-zoom").toggleClass("banner-zoom",!0):a?void t.closeMenu():(t.selectCategory(r),t.isOpenMenu?t.openType==r?t.closeMenu():t.changeMenu(r):(t.isOpenMenu=!0,t.$fixPanel.toggleClass("open-nav",!0),t.changeMenu(r),setTimeout(function(){$(document).on("click.openSubNav",function(e){$(e.target).closest(".js-sub-nav-list").length||t.closeMenu()})},50)),void(t.openType=r))},closeMenu:function(){var e=this;e.$fixPanel.toggleClass("open-nav",!1),$(document).off("click.openSubNav"),e.isOpenMenu=!1,e.selectCategory(),e.openType=""},changeMenu:function(e){var t=this;t.$(".js-nav-goods-list").toggleClass("on",!1),t.$('.js-nav-goods-list[data-type="'+e+'"]').toggleClass("on",!0)},navGoodsData:function(){var e=[{category:"mobile",list:[{mark:"t2",name:"Smartisan T2",price:2499,link:""},{mark:"youth",name:"坚果手机标准版",price:699,link:"jianguo?youth"},{mark:"art",name:"坚果手机文艺青年版",price:799,link:"jianguo?art"},{mark:"black",name:"坚果手机黑色版",price:699,link:"jianguo?black"}]},{category:"warranty",list:[{mark:"accident",name:"意外保修服务",link:"insurance/information"},{mark:"delay",name:"延长保修服务",link:"insurance/information"}]}];return e}})}),window.Store.addService("User",function(e,t){function o(){var e=this;e.isLoggedIn=!1,e.info={},e.LayoutView=null,e.DialogPlugin=null,e.CartService=null,e.AccountModel=null}return o.prototype.init=function(){var e=this;e.LayoutView=t.getView("Layout"),e.DialogPlugin=t.getPlugin("Dialog"),e.CartService=t.getService("Cart"),e.AccountModel=t.getModel("Account")},o.prototype.getInfo=function(o,i){var r=this;if(o){var a=e.cookies.get("SCA_LOGIN");return a?(r.isLoggedIn=!0,r.LayoutView.login(),t.proxyDefer({nickname:"smartisan"})):(r.isLoggedIn=!1,r.LayoutView.logout(),t.proxyDeferError(10004,"请登录"))}var n={s:0|i};return mainService.ajax({url:"Account/Info",data:n,success:function(e){r.info=e,r.isLoggedIn=!0,e.avatar_url=e.avatar_url?e.avatar_url:t.config.defaultAvatar,e.couponNotice=1==e.t1_gift,r.LayoutView.login();var o=r.parseInfo(e);return r.AccountModel.set(o),o},error:function(e){return r.LayoutView.logout(),r.isLoggedIn=!1,!1}})},o.prototype.parseInfo=function(t){var o=e.extend({},t);return o.email_active=0|o.email_active,o.cellphone_active=0|o.cellphone_active,o.secques_active=0|o.secques_active,o.verifyedEmail=o.email&&o.email_active,o.unVerifyEmail=o.email&&!o.email_active,o},o.prototype.sendMobileCaptcha=function(e,t){var o=this,i={};return i["[cellphone]"]=escape(e),i["[captcha]"]=escape(t),mainService.ajax({type:"get",dataType:"jsonp",url:"cellphone/?m=post",data:i,success:function(e){return o.isLoggedIn=!0,e}})},o.prototype.getCashCardList=function(){return mainService.ajax({url:"CashCard/getList"})},o.prototype.exportGiftcard=function(e){return mainService.ajax({url:"cashCard/exchangeTaobao",data:e,error:function(){return!1}})},o.prototype.sendEmail=function(){return mainService.ajax({type:"post",url:"Account/sendEmail"})},o.prototype.isLogin=function(e){var o=this,i={};return e&&(i.fields="avatar_url,nickname,cellphone,t1_gift"),mainService.ajax({url:"Account/IsLogin",data:i,success:function(e){return o.isLoggedIn=!0,o.LayoutView.login(),e.avatar_url=e.avatar_url?e.avatar_url:t.config.defaultAvatar,e.couponNotice=1==e.t1_gift,o.AccountModel.set(e),e},error:function(e){return o.LayoutView.logout(),o.isLoggedIn=!1,!1}})},o.prototype.login=function(e,o){var i=this;return t.currentView.loginProxy=e,i.isLogin().then(function(o){return t.currentView.loginProxy=null,"function"==typeof e&&e(),o},function(t){return("function"==typeof e||o)&&i.openLogin(),!1})},o.prototype.openLogin=function(){var o=this;return o.DialogPlugin.closeAll(),t.config.isMobileTerminal?(window.location.href="https://account.smartisan.com/#/login?return_url="+encodeURIComponent(window.location.href),!1):(IframeDialog.open(IframeDialog.config.loginUrl),void(o.hasMsgListner||(e(window).on("message",jQuery.proxy(o.messageHandler,o)),o.hasMsgListner=!0)))},o.prototype.register=function(){var e=this;e.openRegister()},o.prototype.openRegister=function(){var o=this;return t.config.isMobileTerminal?(window.location.href="https://account.smartisan.com/#/register?return_url="+encodeURIComponent(window.location.href),!1):(IframeDialog.open(IframeDialog.config.registerUrl),void(o.hasMsgListner||(e(window).on("message",jQuery.proxy(o.messageHandler,o)),o.hasMsgListner=!0)))},o.prototype.openModifyAvatar=function(){var o=this;return t.config.isMobile?(window.location.href="https://account.smartisan.com/#/login?return_url="+encodeURIComponent(window.location.href),!1):(IframeDialog.open(IframeDialog.config.modifyAvatarUrl),t.currentView.isOpenAvatarDialog=!0,void(o.hasMsgListner||(e(window).on("message",jQuery.proxy(o.messageHandler,o)),o.hasMsgListner=!0)))},o.prototype.logout=function(){var t=this;t.openLogout(),t.isLoggedIn=!1,e.cookies.del("couponNotice"),t.AccountModel.clear()},o.prototype.openLogout=function(){var o=this;return t.config.isMobile?(window.location.href="https://account.smartisan.com/#/logout?return_url="+encodeURIComponent(window.location.href),!1):(IframeDialog.open(IframeDialog.config.logoutUrl,!0),void(o.hasMsgListner||(e(window).on("message",jQuery.proxy(o.messageHandler,o)),o.hasMsgListner=!0)))},o.prototype.messageHandler=function(e){var o=this,i=e.originalEvent,r=t.currentView.userRequired,a=t.currentView.pageReload;if(i.origin==IframeDialog.config.origin){if("isLoggedIn"==i.data){if(o.getInfo(),IframeDialog.close(),o.LayoutView.login(),"function"==typeof t.currentView.loginProxy)return t.currentView.loginProxy(),!1;if(!t.currentView.notSyncCart&&o.CartService.syncList(),a||r)return void Backbone.history.loadUrl()}if("isLoggedOut"==i.data&&(o.isLoggedIn=!1,o.info={},IframeDialog.close(),o.LayoutView.logout(),o.CartService.removeAll(!0),r&&(window.location.href="/")),"isRegistered"==i.data){if(o.getInfo(),IframeDialog.close(),o.LayoutView.login(),!t.currentView.notSyncCart&&o.CartService.syncList(),"function"==typeof t.currentView.loginProxy)return t.currentView.loginProxy(),!1;if(a||r)return void Backbone.history.loadUrl()}if("isModifiedAvatar"==i.data&&(o.getInfo(),IframeDialog.close()),"dialogClose"==i.data){if(IframeDialog.close(),t.currentView.isOpenAvatarDialog)return void(t.currentView.isOpenAvatarDialog=!1);r&&(window.location.href="/")}}},o.prototype.staticLogout=function(){var e=this;e.LayoutView.logout(),e.isLoggedIn=!1},o.prototype.staticIsLogout=function(){var e=this;return e.isLoggedIn},new o}(jQuery,window.Store)),window.Store.addView("Home",function(){return Backbone.View.extend({el:".content",events:{"click .js-wap-nav-toggle":"toggleWapNav"},initialize:function(){var e=this;e.AccountModel=Store.getModel("Account"),e.NoticeDialog=new(Store.getView("NoticeDialog"))({className:"notice-dialog"}),e.listenTo(e.AccountModel,"change",e.openNotice)},render:function(){var e=this,t=new(Store.getView("UILoop"))({el:e.$(".js-loop-list"),auto:!0,time:5e3});t.render(),e.NoticeDialog.render()},openNotice:function(e,t){var o=this;e.get("couponNotice")&&o.NoticeDialog.render()},toggleWapNav:function(){var e=this,t=e.$(".js-wap-official-topbar");t.hasClass("selected")?(t.toggleClass("selected",!1),$(document).off("click.openWapNav")):(t.toggleClass("selected",!0),setTimeout(function(){$(document).on("click.openWapNav",function(){t.toggleClass("selected",!1),$(document).off("click.openWapNav")})},50))}})}),window.Store.addView("Fiil",function(){return Backbone.View.extend({el:".content",events:{"click .js-checkout":"checkout","click .js-buy":"buyFiil"},initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.dialogPlugin=Store.getPlugin("Dialog"),e.CartService=Store.getService("Cart"),e.GoodsService=Store.getService("Goods"),e.UserService=Store.getService("User"),e.FiilDialog=new(Store.getView("FiilDialog"))},render:function(e,t){var o=this;o.tempData=t,o.button=o.uiPlugin.loadingBtn(o.$(".js-checkout")),Store.currentView.loginProxy=function(){Backbone.history.loadUrl()}},checkout:function(e){var t=this,o=$(e.currentTarget);return o.hasClass("disabled-btn")?!1:void t.UserService.login(function(){return t.$(".js-checkout").hasClass("disabled-btn")?(Backbone.history.loadUrl(),!1):void t.GoodsService.isReservationFiil().done(function(e){e?t.FiilDialog.render(function(e,i){t.reservationFiil(e,i,o)},e.mobile,t.button):t.updateBtn(o)}).fail(function(e,o,i){return t.button.reset(),10004==e?!1:void t.dialogPlugin.message({message:o})})})},reservationFiil:function(e,t,o){var i=this;i.GoodsService.reservationFiil(e).done(function(){t.$(".js-check-panel").toggleClass("fn-hide",!0),Store.config.opacity?t.$(".js-success-panel").fadeIn():t.$(".js-success-panel").toggleClass("fn-hide",!1),i.updateBtn(o)}).fail(function(e,r,a){return t.close(),10004==e?!1:10005==e?(i.updateBtn(o),!1):void i.dialogPlugin.message({message:r})})},buyFiil:function(){var e=this;e.CartService.addCart({sku:100015101,num:1}),Store.Router.navigate("cart",{trigger:!0})},updateBtn:function(e){e.toggleClass("disabled-btn",!0),e.children().text("已预约")}})}),window.Store.addView("Mobile",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.dialogPlugin=Store.getPlugin("Dialog"),e.UserService=Store.getService("User"),e.MobileService=Store.getService("Mobile"),e.OrderService=Store.getService("Order"),e.UserService=Store.getService("User"),e.mobileData=e.MobileService.model("defect")},events:{"mouseenter .js-gallery-wrapper":"galleryEnter","mouseleave .js-gallery-wrapper":"galleryLeave","click .dot-nav-gallery li":"changeGalleryImage","click .js-gallery-prev":"galleryPrev","click .js-gallery-next":"galleryNext","click .js-defect-list li":"chooseDefect","click .js-standard-list li":"chooseStandard","click .js-buy-btn":"buyMobile"},render:function(e,t){var o=this;o.tempData=t,o.button={},o.curMobile=t.curMobile,o.bindFixedBar(),o.autoGallery=null,o.$imageGallery=o.$(".js-image-gallery"),o.$dotGallery=o.$(".js-dot-gallery"),o.galleryIndex=0,o.isInGallery=!1,o.galleryStart(),o.button=o.uiPlugin.loadingBtn(o.$(".js-buy-btn")),o.updatePageImages()},renderSelection:function(){var e=this,t=ct.get("tempMobileSelection",!0),o={curMobile:e.curMobile,pageParams:e.tempData.pageParams};e.$(".js-selection-wrapper").html(ct.compile(t,o))},chooseStandard:function(e){var t=this,o=$(e.currentTarget),i=o.data("index"),r=t.tempData.pageParams.groupStandard,a=null;return o.hasClass("on")||o.hasClass("disabled")?!1:(a=r[i][1],void t.chooseMobile(a))},chooseDefect:function(e){var t=this,o=$(e.currentTarget),i=o.data("id"),r=null;return o.hasClass("on")||!t.mobileData.phones[i].stock?!1:(r=t.mobileData.phones[i],void t.chooseMobile(r))},chooseMobile:function(e){var t=this,o=ct.get("tempMobileCheckoutBar",!0),i={curMobile:e};t.curMobile=e,t.$(".js-phone-fixed-bar").html(ct.compile(o,i)),t.button=t.uiPlugin.loadingBtn(t.$(".js-buy-btn")),t.renderSelection()},updatePageImages:function(e){var t=this,o=ct.get("t1-specification"),i={pageImages:t.tempData.pageImages};o.done(function(e){t.$(".js-specification-wrapper").html(ct.compile(e,i))})},changeGalleryImage:function(e){{var t=this,o=$(e.currentTarget);t.$(".product-gallery")}return o.hasClass("active")?!1:void t.galleryUpdate(o.index())},galleryEnter:function(){if(Store.config.isMobile)return!1;var e=this;e.isInGallery=!0,e.galleryStop()},galleryLeave:function(){if(Store.config.isMobile)return!1;var e=this;e.isInGallery=!1,e.galleryStart()},galleryStart:function(){var e=this;e.autoGallery=setTimeout(function(){e.galleryNext()},5e3)},galleryPrev:function(){var e=this,t=--e.galleryIndex<0?e.$dotGallery.find("li").length-1:e.galleryIndex;e.galleryUpdate(t)},galleryNext:function(){var e=this,t=++e.galleryIndex>e.$dotGallery.find("li").length-1?0:e.galleryIndex;e.galleryUpdate(t)},galleryUpdate:function(e){var t=this;t.galleryIndex=e,t.galleryStop(),t.$imageGallery.find(".on").toggleClass("on",!1),t.$dotGallery.find(".active").toggleClass("active",!1),t.$imageGallery.find("li").eq(e).toggleClass("on",!0),t.$dotGallery.find("li").eq(e).toggleClass("active",!0),!t.isInGallery&&t.galleryStart()},galleryStop:function(){var e=this;e.autoGallery&&clearTimeout(e.autoGallery)},bindFixedBar:function(){if(Store.config.isMobile)return!1;var e=this,t=e.$(".js-phone-fixed-bar"),o=e.$(".js-phone-fixed-bar-bg"),i=e.$(".phone-bottom-bg").offset().top;$(window).on("scroll",function(){t.toggleClass("phone-fixed-bar",$(this).scrollTop()>i),o.toggleClass("phone-fixed-bar-bg",$(this).scrollTop()>i)})},buyMobile:function(e){var t=this,o=$(e.currentTarget),i=t.curMobile;return o.hasClass("disabled-btn")||!i.stock?!1:(t.button.loading(),void t.MobileService.createTempOrder({mobileData:i}).done(function(e){Store.Router.navigate("accessories/"+e.id,{trigger:!0})}).fail(function(o){t.button.reset(),10004==o&&t.UserService.openLogin(function(){t.buyMobile(e)})}))}})}),window.Store.addView("PageT1",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.dialogPlugin=Store.getPlugin("Dialog"),e.UtilService=Store.getService("Util"),e.UserService=Store.getService("User"),e.MobileService=Store.getService("Mobile"),e.MobileGoodsService=Store.getService("MobileGoods"),e.OrderService=Store.getService("Order"),e.UserService=Store.getService("User"),e.goodsView=null},events:{"mouseenter .js-gallery-wrapper":"galleryEnter","mouseleave .js-gallery-wrapper":"galleryLeave","click .dot-nav-gallery li":"changeGalleryImage","click .js-gallery-prev":"galleryPrev","click .js-gallery-next":"galleryNext","click .js-buy-btn":"buyMobile"},render:function(e,t){var o=this;o.tempData=t,o.mapPageImages=o.MobileGoodsService.mapPageImagesT1,o.button={},o.curMobile=t.curMobile,o.curMobileColor=o.curMobile.color,o.autoGallery=null,o.$imageGallery=o.$(".js-image-gallery"),o.$dotGallery=o.$(".js-dot-gallery"),o.galleryIndex=0,o.isInGallery=!1,o.galleryStart(),o.button=o.uiPlugin.loadingBtn(o.$(".js-buy-btn")),o.updatePageImages(),o.promiseChangeMobile=$.Deferred(),o.goodsView=t.isDefect?new(Store.getView("DefectT1"))({el:o.$(".js-select-capacity-panel"),mobileStock:t.mobileStock,chooseMobile:function(e){o.chooseMobile(e)}}):new(Store.getView("NormalT1"))({el:o.$(".js-select-capacity-panel"),mobileStock:t.mobileStock,chooseMobile:function(e){o.chooseMobile(e)}}),o.goodsView.render(o.curMobile),o.goodsView.promiseView.done(function(){o.bindFixedBar()})},chooseMobile:function(e){var t=this,o=ct.get("tempMobileCheckoutBar",!0),i={curMobile:e};t.curMobile=e,t.$(".js-phone-fixed-bar").html(ct.compile(o,i)),t.button=t.uiPlugin.loadingBtn(t.$(".js-buy-btn")),t.updatePageImages(t.curMobile.color)},updatePageImages:function(e){var t=this,o=ct.get("t1-specification");if(e&&e==t.curMobileColor)return!1;e&&(t.curMobileColor=e);var i={pageImages:t.mapPageImages[t.curMobileColor],isDefect:t.tempData.isDefect};$.each(i.pageImages.gallery,function(e,o){t.$(".js-gallery-wrapper").find("li").eq(e).find("img").attr("src",o)}),o.done(function(e){t.$(".js-specification-wrapper").html(ct.compile(e,i))})},changeGalleryImage:function(e){{var t=this,o=$(e.currentTarget);t.$(".product-gallery")}return o.hasClass("active")?!1:void t.galleryUpdate(o.index())},galleryEnter:function(){if(Store.config.isMobile)return!1;var e=this;e.isInGallery=!0,e.galleryStop()},galleryLeave:function(){if(Store.config.isMobile)return!1;var e=this;e.isInGallery=!1,e.galleryStart()},galleryStart:function(){var e=this;e.autoGallery=Store.loop.t1=setInterval(function(){e.galleryNext()},5e3)},galleryPrev:function(){var e=this,t=--e.galleryIndex<0?e.$dotGallery.find("li").length-1:e.galleryIndex;e.galleryUpdate(t)},galleryNext:function(){var e=this,t=++e.galleryIndex>e.$dotGallery.find("li").length-1?0:e.galleryIndex;e.galleryUpdate(t)},galleryUpdate:function(e){var t=this;t.galleryIndex=e,t.galleryStop(),t.$imageGallery.find(".on").toggleClass("on",!1),t.$dotGallery.find(".active").toggleClass("active",!1),t.$imageGallery.find("li").eq(e).toggleClass("on",!0),t.$dotGallery.find("li").eq(e).toggleClass("active",!0),!t.isInGallery&&t.galleryStart()},galleryStop:function(){var e=this;e.autoGallery&&clearInterval(e.autoGallery)},bindFixedBar:function(){if(Store.config.isMobile)return!1;var e=this,t=e.$(".js-phone-fixed-bar-bg").clone().appendTo(e.$el),o=e.$(".js-phone-fixed-bar").clone().appendTo(e.$el),i=e.$(".phone-bottom-bg").offset().top;$(window).on("scroll",function(){var e=$(this).scrollTop()>i;o.toggle(e).toggleClass("phone-fixed-bar",e),t.toggle(e).toggleClass("phone-fixed-bar-bg",e)})},buyMobile:function(e){var t=this,o=$(e.currentTarget),i=t.curMobile;return o.hasClass("disabled-btn")||!i.stock?!1:(t.button.loading(),void t.MobileService.createTempOrder({mobileData:i}).done(function(e){Store.Router.navigate("accessories/"+e.id,{trigger:!0})}).fail(function(o){t.button.reset(),10004==o&&t.UserService.openLogin(function(){t.buyMobile(e)})}))}})}),window.Store.addView("NormalT1",function(){return Backbone.View.extend({initialize:function(e){var t=this;t.MobileGoodsService=Store.getService("MobileGoods"),t.MobileService=Store.getService("Mobile"),t.promiseView=ct.get("t1-normal-goods"),t.mobileMap=t.MobileGoodsService.mapNormalT1,t.mobileList=t.MobileGoodsService.listNormalT1,t.chooseMobileFn=e.chooseMobile,t.mobileStock=e.mobileStock},events:{"click .js-color-list li":"chooseColor","click .js-standard-list li":"chooseStandard","click .js-capacity-list li":"chooseCapacity"},render:function(e){var t=this;t.curMobile=e,t.resetView(e)},resetView:function(e){var t=this,e=$.extend({},e,t.mobileStock[e.sku]),o={curMobile:e,pageParams:t.MobileService.pageNormalParams(e)};t.promiseView.done(function(i){var r=ct.compile(i,o);t.$el.html(r),t.chooseMobileFn(e)})},chooseColor:function(e){var t=this,o=$(e.currentTarget),i=o.data("color");return o.hasClass("on")||o.hasClass("disabled")?!1:(t.filterMobile({color:i,standard:"4G"}),void t.resetView(t.curMobile))},chooseStandard:function(e){var t=this,o=$(e.currentTarget),i=o.data("standard");return o.hasClass("on")||o.hasClass("disabled")?!1:(t.filterMobile({color:t.curMobile.color,standard:i,capacity:"32GB"}),void t.resetView(t.curMobile))},chooseCapacity:function(e){var t=this,o=$(e.currentTarget),i=o.data("capacity");return o.hasClass("on")||o.hasClass("disabled")?!1:(t.filterMobile({color:t.curMobile.color,standard:t.curMobile.standard,capacity:i}),void t.resetView(t.curMobile))},filterMobile:function(e){var t,o,i=this;t=_.where(i.mobileList,e),t&&(o=_.findWhere(t,{stock:!0}),i.curMobile=o?o:t[0])}})}),window.Store.addView("DefectT1",function(){return Backbone.View.extend({initialize:function(e){var t=this;t.MobileGoodsService=Store.getService("MobileGoods"),t.MobileService=Store.getService("Mobile"),t.promiseView=ct.get("t1-defect-goods"),t.mobileMap=t.MobileGoodsService.mapDefectT1,t.chooseMobileFn=e.chooseMobile,t.mobileStock=e.mobileStock},events:{"click .js-defect-list li":"chooseDefect","click .js-standard-list li":"chooseStandard"},render:function(e){var t=this;t.pageParams=t.MobileService.pageParams(e),t.resetView(e)},resetView:function(e){var t=this,e=$.extend({},e,t.mobileStock[e.sku]),o={curMobile:e,pageParams:t.pageParams};t.promiseView.done(function(i){var r=ct.compile(i,o);t.$el.html(r),t.chooseMobileFn(e)})},chooseStandard:function(e){var t=this,o=$(e.currentTarget),i=o.data("index"),r=t.pageParams.groupStandard,a=null;return o.hasClass("on")||o.hasClass("disabled")?!1:(a=r[i][1],void t.resetView(a))},chooseDefect:function(e){var t=this,o=$(e.currentTarget),i=o.data("id"),r=null;return o.hasClass("on")||!t.mobileMap[i].stock?!1:(r=t.mobileMap[i],void t.resetView(r))}})}),window.Store.addView("Nuts",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.UtilService=Store.getService("Util"),e.uiPlugin=Store.getPlugin("UI"),e.MobileGoodsService=Store.getService("MobileGoods"),e.MobileService=Store.getService("Mobile"),e.NutsService=Store.getService("Nuts"),e.UserService=Store.getService("User")},events:{"click .js-choose-edition li":"checkRadio","click .js-choose-version li":"checkRadio","click .js-choose-capacity li":"checkRadio","click .js-choose-color li":"checkRadio","click .js-checkout":"checkout"},render:function(e,t){var o=this;o.tempData=t,o.curMobileEditionList=[],o.curMobileColorList=[],o.curMobileCapacityList=[],o.curMobile=$.extend({},t.curMobile);var i;t.pageParams.curMobile&&(i=$.extend({},t.pageParams.curMobile)),o.button=o.uiPlugin.loadingBtn(o.$(".js-checkout")),o.imageLoopView=new(Store.getView("UILoop"))({el:o.$(".js-loop-list"),useDot:!1,auto:!0,time:3e3}),o.imageLoopView.render(),o.goods={warrantys:{}},o.$checkoutPanel=o.$(".js-checkout-panel"),t.pageParams.allStock||o.$(".js-checkout a").text("已售罄"),o.radioEdition=o.uiPlugin.radio({wrapper:o.$el,name:"edition",checked:i&&i.edition,notDefault:!i,callback:function(e,t){e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseEdition(e.data("id"))}}),o.radioVersion=o.uiPlugin.radio({wrapper:o.$el,name:"version",checked:i&&i.version,notDefault:!i,callback:function(e,t){e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseVersion(e.data("id"))}}),o.radioColor=o.uiPlugin.radio({wrapper:o.$el,name:"color",checked:i&&i.color,notDefault:!i,callback:function(e,t){e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseColor(e.data("id"))}}),o.radioCapacity=o.uiPlugin.radio({wrapper:o.$el,name:"capacity",checked:i&&i.capacity,notDefault:!i,callback:function(e,t){e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseCapacity(e.data("id"))}}),Store.config.isMobile||o.bindFixedBar()},bindFixedBar:function(){if(Store.config.isMobile)return!1;var e=this,t=e.$(".js-checkout-panel"),o=$(".footer").offset().top,i=$(window).height();t.toggleClass("checkout-fix-panel-follow",o>=i),$(window).on("resize, scroll",function(){var e=$(window).height(),i=$(this).scrollTop();t.toggleClass("checkout-fix-panel-follow",o>=i+e)})},chooseEdition:function(e){var t=this,o=ct.get("tempNutsEdition",!0),i={};i.edition=e,t.curMobile.version?(i.version=t.curMobile.version,i=t.tempData.pageParams.defChooseMobileData[e][i.version]):t.tempData.pageParams.defChooseMobileData[e].hasStock&&(i=t.tempData.pageParams.defChooseMobileData[e].hasStock),t.curMobile=i?$.extend({},i):$.extend({},{edition:e,version:t.curMobile.version}),t.imageLoopView.options.auto=!1;var r=t.imageLoopView.$('.js-loop-item[data-version="'+t.curMobile.version+'"]'),a=0;r=t.curMobile.color?r.filter('[data-color="'+t.curMobile.color+'"]'):r.first(),a=r.index(),t.chooseParametersImage(r.data("color")),t.imageLoopView.loopUpdate(a),Store.config.isIE?(t.imageLoopView.$el.toggleClass("switch",!1),setTimeout(function(){t.imageLoopView.$el.toggleClass("switch",!0)},0)):t.imageLoopView.$el.toggleClass("switch",!1).show().delay(0).toggleClass("switch",!0),t.$(".js-standard-label").html(ct.compile(o,{curMobile:t.curMobile})),t.chooseMobile()},chooseVersion:function(e){var t=this,o=ct.get("tempNutsVersion",!0),i={};i=t.curMobile.edition?t.tempData.pageParams.defChooseMobileData[t.curMobile.edition][e]:t.tempData.pageParams.defChooseMobileData.netcom[e]||t.tempData.pageParams.defChooseMobileData.all[e],t.curMobile=i?$.extend({},i):$.extend({},{edition:t.curMobile.edition,version:e}),t.imageLoopView.options.auto=!1;var r=t.imageLoopView.$('.js-loop-item[data-version="'+e+'"]'),a=0;r=t.curMobile.color?r.filter('[data-color="'+t.curMobile.color+'"]'):r.first(),a=r.index(),t.chooseParametersImage(r.data("color")),t.imageLoopView.loopUpdate(a),Store.config.isIE?(t.imageLoopView.$el.toggleClass("switch",!1),setTimeout(function(){t.imageLoopView.$el.toggleClass("switch",!0)},0)):t.imageLoopView.$el.toggleClass("switch",!1).show().delay(0).toggleClass("switch",!0),t.$(".js-version-label").html(ct.compile(o,{curMobile:t.curMobile})),t.chooseMobile()},chooseColor:function(e){var t=this,o={};if(t.curMobile.color==e)return!1;o=$.extend({},{edition:t.curMobile.edition,version:t.curMobile.version,color:e});var i,r=_.where(t.MobileGoodsService.mapPhones,o);r.length&&$.each(r,function(e,r){r.stock&&(i=r.capacity,t.curMobile.capacity&&(o.capacity=t.curMobile.capacity))}),!o.capacity&&i&&(o.capacity=i),t.curMobile=$.extend({},o),t.chooseParametersImage(e);var a=t.imageLoopView.$('.js-loop-item[data-color="'+e+'"]'),n=a.index();e!=t.imageLoopView.$(".selected").data("color")&&(Store.config.isIE?(t.imageLoopView.$el.toggleClass("switch",!1),setTimeout(function(){t.imageLoopView.$el.toggleClass("switch",!0)},0)):t.imageLoopView.$el.toggleClass("switch",!1).show().delay(0).toggleClass("switch",!0)),t.imageLoopView.loopUpdate(n),t.chooseMobile()},chooseCapacity:function(e){var t=this,o={};o=$.extend({},{edition:t.curMobile.edition,version:t.curMobile.version,color:t.curMobile.color,capacity:e}),t.curMobile=$.extend({},o),t.chooseMobile()},chooseMobile:function(){var e=this,t=ct.get("tempNutsMobileParams",!0),o={};o.curMobile=$.extend({},e.curMobile),o.pageParams=e.NutsService.getNutsParams(e.curMobile.version,e.curMobile),e.$(".js-choose-mobile-params").html(ct.compile(t,o)),e.subTotal()},chooseParametersImage:function(e){var t=this;t.$(".js-parameters-size-color").removeClass().addClass("mobile-size js-parameters-size-color "+e),t.$(".js-parameters-keysPorts").removeClass().addClass("spec-parameters-detail spec-parameters-keysPorts js-parameters-keysPorts "+e)},subTotal:function(){var e=this,t=ct.get("tempNutsCheckoutBar",!0),o={};o={edition:e.curMobile.edition,version:e.curMobile.version,color:e.curMobile.color,capacity:e.curMobile.capacity};var i=_.where(e.MobileGoodsService.mapPhones,o),r={};1==i.length&&e.curMobile.capacity?r=i[0]:e.curMobile.color&&e.curMobile.capacity&&(delete e.curMobile.color,delete e.curMobile.capacity),r=$.extend({},r,e.NutsService.mapStock[r.sku]);var a=0|r.price,n=0==a?0:a+200;e.$checkoutPanel.html(ct.compile(t,{curMobile:r,total:a,cost:n}))},checkout:function(e){var t=this,o=$(e.currentTarget),i=(t.tempData.pageParams.activity,_.where(t.MobileGoodsService.mapPhones,t.curMobile)),r={};o.hasClass("disabled-btn")||1!=i.length||(i=i[0],r={mobile_id:i.sku,pay_type:2,mobileData:i},t.button.loading(),t.MobileService.createTempOrder(r).done(function(e){t.UtilService.SMpvEvent("坚果","现在购买"),Store.Router.navigate("accessories/"+e.id,{trigger:!0})}).fail(function(o){t.button.reset(),10004==o&&t.UserService.openLogin(function(){t.buyMobile(e)})}))},checkRadio:function(e){var t=$(e.currentTarget),o=$(e.target);t.hasClass("disabled")||o.closest(".blue-radio").length||t.find("input").prop("checked",!0).change()}})}),window.Store.addView("Accessories",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.DialogPlugin=Store.getPlugin("Dialog"),e.UtilService=Store.getService("Util"),e.UserService=Store.getService("User"),e.MobileService=Store.getService("Mobile"),e.CartService=Store.getService("Cart"),e.MobileFittingService=Store.getService("MobileFitting"),e.MobileGoodsService=Store.getService("MobileGoods"),e.NutsService=Store.getService("Nuts"),e.mapCovers=e.MobileGoodsService.mapCovers,e.mapHeadset=e.MobileGoodsService.mapHeadset},events:{"click .js-warranty-selection li":"checkRadio","click .js-choose-color li":"checkRadio","click .js-choose-headset li":"checkRadio","click .js-cover-selection li":"checkRadio","click .js-headset-selection li":"checkRadio","click .js-delete-cart-item":"deleteCartItem","click .js-add-cover-cart-item":"addCoverToCart","click .js-add-headset-cart-item":"addHeadsetToCart","click .js-wap-open-choose-btn":"wapOpenChooseFitting","click .js-buy-btn":"buyMobile"},render:function(e,t){var o=this;if(o.$checkoutEmptyBar=o.$(".js-cart-empty-bar"),o.$checkoutBar=o.$(".js-cart-checkout-bar"),o.$checkoutList=o.$(".js-cart-checkout-list"),o.$total=o.$(".js-total"),o.$costTotal=o.$(".js-cost-total"),o.discountNum=0,o.radioWarranty={},o.button={},o.curCoverData=t.goodsStock.cover&&t.goodsStock.cover.curData||{},o.curHeadsetData=t.goodsStock.headset&&t.goodsStock.headset.curData||{},o.tempData=t,t.order.stepFitting){o.radioColor=o.uiPlugin.radio({wrapper:o.$(".js-choose-color"),name:"color",notDefault:!0,callback:function(e,t){var i=e.prop("checked");i?(e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseColor(e.data("id"))):e.closest("li").toggleClass("selected",!1)}}),o.uiPlugin.radio({wrapper:o.$(".js-cover-selection"),name:"cover-radio",checked:0,callback:function(e,t){var i=0!=e.data("id");i?(o.$(".js-choose-color").children("li").each(function(){$(this).toggleClass("disabled",!$(this).data("stock"))}),o.radioColor.on(o.curCoverData.sku)):(o.$(".js-choose-color").children("li").toggleClass("selected",!1).toggleClass("disabled",!0),o.emptyCoverCart()),o.countTotal()}}),o.radioHeadset=o.uiPlugin.radio({wrapper:o.$(".js-choose-headset"),name:"headset",notDefault:!0,callback:function(e,t){var i=e.prop("checked");i?(e.closest("li").toggleClass("selected",!0).siblings().toggleClass("selected",!1),o.chooseHeadsetColor(e.data("id"))):e.closest("li").toggleClass("selected",!1);

}}),o.uiPlugin.radio({wrapper:o.$(".js-headset-selection"),name:"headset-radio",checked:0,callback:function(e,t){var i=e.data("id"),r=0!=i,a=ct.get("tempHeadsetColorList",!0);if(r){var n=o.tempData.goodsStock.headset.listData[i];o.$(".js-add-headset-cart-item").toggleClass("disabled-btn",!0),o.$(".js-choose-headset").html(ct.compile(a,{headsetColorData:n})),o.$(".js-choose-headset").children("li").each(function(){$(this).toggleClass("disabled",!$(this).data("stock"))}),o.curHeadsetData.version==i?o.radioHeadset.on(o.curHeadsetData.sku):$.each(n,function(e,t){return t.stock?(o.radioHeadset.on(t.sku),!1):void 0})}else o.$(".js-choose-headset").children("li").toggleClass("selected",!1).toggleClass("disabled",!0),o.emptyHeadsetCart();o.countTotal()}});var i=new(Store.getView("CartQuantity"))({el:o.$el,useData:!0,canDelete:!0,callback:function(e,t){if(Store.config.isMobile){var i=e.closest(".js-select-quantity");i.toggleClass("select-open",t>0)}else if(0==t){var r=e.closest("li"),a=r.data("accessories");o.mapCovers[a]&&o.removeCoverCart(r),o.mapHeadset[a]&&o.removeHeadsetCart(r)}o.countTotal()}});o.cartQuantity=i.render()}else $.each(t.warrantys,function(e,t){o.radioWarranty[t.postName]=o.uiPlugin.radio({wrapper:o.$(".js-accessories-list"),name:t.postName,callback:function(e,i){var r=0!=e.data("id");o.$('[data-warning="'+t.postName+'"]').toggleClass("warranty-warning-show",r),r?o.addAccessories(t):o.removeAccessories(t),o.countTotal()}})});o.bindFixedBar(),o.button=o.uiPlugin.loadingBtn(o.$(".js-buy-btn"))},chooseColor:function(e){var t=this,o=t.$(".js-choose-color-label"),i=t.$(".js-choose-label"),r=i.find(".js-choose-cover-color"),a=t.$(".js-cover-image-list"),n=t.mapCovers[e];t.curCoverData=$.extend({},n),t.$(".js-add-cover-cart-item").toggleClass("disabled-btn",!1),o.toggleClass("fn-hide",!0),i.toggleClass("fn-hide",!1),r.text(n.colorLabel),a.find(".selected").toggleClass("selected",!1),a.find('[data-color="'+n.color+'"]').toggleClass("selected",!0)},chooseHeadsetColor:function(e){var t=this,o=t.$(".js-choose-headset-label"),i=t.$(".js-choose-headset-item-label"),r=i.find(".js-choose-headset-color"),a=t.$(".js-headset-image-list"),n=t.mapHeadset[e];t.curHeadsetData=$.extend({},n),t.$(".js-add-headset-cart-item").toggleClass("disabled-btn",!1),o.toggleClass("fn-hide",!0),i.toggleClass("fn-hide",!1),r.text(n.colorLabel+n.versionLessLabel),a.find(".selected").toggleClass("selected",!1),a.find('[data-color="'+n.color+'"]').toggleClass("selected",!0)},addAccessories:function(e){var t=this,o=ct.get("tempAccessoriesCartItem",!0),i=e,r=ct.compile(o,i,!0);t.$checkoutList.append(r),1==t.$checkoutList.children().length&&(t.$checkoutEmptyBar.toggleClass("cart-empty-bar-show",!1),t.$checkoutEmptyBar.toggleClass("cart-empty-bar-hide",!0),t.$checkoutBar.toggleClass("cart-checkout-bar-show",!0)),setTimeout(function(){r.addClass("item-fadein")},1)},removeAccessories:function(e){var t=this,o=t.$checkoutList.find('[data-accessories="'+e.postName+'"]');delete t.tempData.order[e.postName],t.$checkoutList.children().length>1?(o.removeClass("item-fadein"),setTimeout(function(){o.remove()},300)):t.tempData.order.stepFitting?t.$checkoutList.closest(".cart-checkout-panel").slideUp().siblings(".cart-checkout-panel").toggleClass("cover-cart-checkout-panel",!1):(t.$checkoutBar.toggleClass("cart-checkout-bar-show",!1),t.$checkoutEmptyBar.toggleClass("cart-empty-bar-show",!0),o.remove()),t.MobileService.removeWarrantyCache(t.tempData.order.id,e.postName)},deleteCartItem:function(e){var t=this,o=$(e.currentTarget),i=o.closest("[data-accessories]").data("accessories");t.radioWarranty[i]?t.radioWarranty[i].on("0"):(t.removeAccessories({postName:i}),t.countTotal())},addCoverToCart:function(e){var t,o=this,i=$(e.currentTarget),r=ct.get("tempCoverCartItem",!0),a=o.$(".js-cart-cover-checkout-siderbar"),n=o.$(".js-cart-cover-empty-bar"),s=o.$(".js-cart-cover-checkout-bar"),c=o.$(".js-cart-cover-checkout-list"),l=o.$(".js-cart-headset-checkout-list"),u=o.cartQuantity.getAllNum();if(!i.hasClass("disabled-btn")){if(a.toggleClass("fn-hide",!1),void 0==u[o.curCoverData.sku])t=ct.compile(r,o.curCoverData,!0),c.append(t);else{t=o.$(".js-cart-cover-checkout-list").find('li[data-accessories="'+o.curCoverData.sku+'"]');var d=t.find('.js-select-quantity[data-id="'+o.curCoverData.sku+'"] input'),g=0|d.val();if(g++,g>10)return void o.DialogPlugin.message({message:"已达到可购买的最大数量"});d.val(g).blur()}l.children().length+c.children().length==1&&(n.toggleClass("cart-empty-bar-show",!1),n.toggleClass("cart-empty-bar-hide",!0),s.toggleClass("cart-checkout-bar-show",!0)),o.countTotal(),setTimeout(function(){t.addClass("item-fadein")},50)}},addHeadsetToCart:function(e){var t,o=this,i=$(e.currentTarget),r=ct.get("tempCoverCartItem",!0),a=o.$(".js-cart-headset-checkout-siderbar"),n=o.$(".js-cart-cover-empty-bar"),s=o.$(".js-cart-cover-checkout-bar"),c=o.$(".js-cart-headset-checkout-list"),l=o.$(".js-cart-cover-checkout-list"),u=o.cartQuantity.getAllNum();if(!i.hasClass("disabled-btn")){if(a.toggleClass("fn-hide",!1),void 0==u[o.curHeadsetData.sku])t=ct.compile(r,o.curHeadsetData,!0),c.append(t);else{t=o.$(".js-cart-headset-checkout-list").find('li[data-accessories="'+o.curHeadsetData.sku+'"]');var d=t.find('.js-select-quantity[data-id="'+o.curHeadsetData.sku+'"] input'),g=0|d.val();if(g++,g>10)return void o.DialogPlugin.message({message:"已达到可购买的最大数量"});d.val(g).blur()}c.children().length+l.children().length==1&&(n.toggleClass("cart-empty-bar-show",!1),n.toggleClass("cart-empty-bar-hide",!0),s.toggleClass("cart-checkout-bar-show",!0)),o.countTotal(),setTimeout(function(){t.addClass("item-fadein")},50)}},removeCoverCart:function(e){var t=this,o=t.$(".js-cart-cover-checkout-siderbar"),i=t.$(".js-cart-cover-empty-bar"),r=t.$(".js-cart-cover-checkout-bar"),a=t.$(".js-cart-headset-checkout-list"),n=t.$(".js-cart-cover-checkout-list");n.children().length>1?(e.removeClass("item-fadein"),setTimeout(function(){e.remove()},300)):(o.toggleClass("fn-hide",!0),a.children().length+n.children().length==1&&(r.toggleClass("cart-checkout-bar-show",!1),i.toggleClass("cart-empty-bar-show",!0)),e.remove())},removeHeadsetCart:function(e){var t=this,o=t.$(".js-cart-headset-checkout-siderbar"),i=t.$(".js-cart-cover-empty-bar"),r=t.$(".js-cart-cover-checkout-bar"),a=t.$(".js-cart-headset-checkout-list"),n=t.$(".js-cart-cover-checkout-list");a.children().length>1?(e.removeClass("item-fadein"),setTimeout(function(){e.remove()},300)):(o.toggleClass("fn-hide",!0),a.children().length+n.children().length==1&&(r.toggleClass("cart-checkout-bar-show",!1),i.toggleClass("cart-empty-bar-show",!0)),e.remove())},emptyCoverCart:function(){var e=this,t=(e.$(".js-cart-headset-checkout-siderbar"),e.$(".js-cart-cover-checkout-siderbar")),o=e.$(".js-cart-cover-empty-bar"),i=e.$(".js-cart-cover-checkout-bar"),r=e.$(".js-cart-headset-checkout-list"),a=e.$(".js-cart-cover-checkout-list");e.radioColor.clear(),t.toggleClass("fn-hide",!0),0==r.children().length&&(i.toggleClass("cart-checkout-bar-show",!1),o.toggleClass("cart-empty-bar-show",!0)),a.empty(),e.$(".js-choose-color-label").toggleClass("fn-hide",!1),e.$(".js-choose-label").toggleClass("fn-hide",!0),e.$(".js-cover-image-list").children().first().toggleClass("selected",!0),e.$(".js-add-cover-cart-item").toggleClass("disabled-btn",!0),e.countTotal()},emptyHeadsetCart:function(){var e=this,t=e.$(".js-cart-headset-checkout-siderbar"),o=e.$(".js-cart-cover-empty-bar"),i=e.$(".js-cart-cover-checkout-bar"),r=e.$(".js-cart-headset-checkout-list"),a=e.$(".js-cart-cover-checkout-list");e.radioHeadset.clear(),t.toggleClass("fn-hide",!0),0==a.children().length&&(i.toggleClass("cart-checkout-bar-show",!1),o.toggleClass("cart-empty-bar-show",!0)),r.empty(),e.$(".js-choose-headset-label").toggleClass("fn-hide",!1),e.$(".js-choose-headset-item-label").toggleClass("fn-hide",!0),e.$(".js-headset-image-list").children().first().toggleClass("selected",!0),e.$(".js-add-headset-cart-item").toggleClass("disabled-btn",!0),e.countTotal()},bindFixedBar:function(){if(Store.config.isMobile)return!1;var e=this,t=e.$(".js-accessories-fixed-panel"),o=e.$(".js-phone-fixed-bar"),i=e.$(".js-phone-fixed-bar-bg"),r=e.$(".js-cart-btn").offset().top-15;$(window).on("scroll",function(){t.toggleClass("fn-hide",$(this).scrollTop()<=r),o.toggleClass("phone-fixed-bar",$(this).scrollTop()>r),i.toggleClass("phone-fixed-bar-bg",$(this).scrollTop()>r)})},countTotal:function(){var e=this,t=0|e.tempData.order.total,o=e.tempData.order,i=o.mobileData.price,r=e.$(".js-cart-goods-discount-total"),a=e.$(".js-discount-label");if($.each(e.tempData.warrantys,function(o,r){var a;e.tempData.order.stepFitting?a=!!e.tempData.order[r.postName]:(a=0|(e.radioWarranty[r.postName]&&e.radioWarranty[r.postName].choosed().id),a&&(t+=0|r.price)),a&&(i+=0|r.price)}),e.cartQuantity){var n=e.cartQuantity.getAllNum();e.discountNum=0,$.each(n,function(o,r){e.mapCovers[o]&&(t+=(0|e.mapCovers[o].price)*r.num,i+=(0|e.mapCovers[o].price)*r.num,e.discountNum+=0|r.num),e.mapHeadset[o]&&(t+=(0|e.mapHeadset[o].price)*r.num,i+=(0|e.mapHeadset[o].price)*r.num)})}var s=Store.config.goodsDiscount.cover,c=0;if(o.discount_amount&&(c=o.discount_amount),e.tempData.order.stepFitting&&e.tempData.goodsStock.cover&&e.tempData.goodsStock.cover.discountData){var l=Math.floor(e.discountNum/s.num);c+=s.discount*l}t-=c,i-=c,c>0?(a.text(Store.filter.rmb(c)),r.toggleClass("fn-hide",!1)):r.toggleClass("fn-hide",!0),e.$total.text(i),e.$costTotal.text(i)},buyMobile:function(e){var t=this,o=$(e.currentTarget);if(o.hasClass("disabled-btn"))return!1;if(t.tempData.order.stepFitting){switch(t.tempData.order.mobileData.category){case"nuts":t.UtilService.SMpvEvent("坚果","去结算");break;case"t2":t.UtilService.SMpvEvent("T2","去结算")}t.checkoutStep()}else{var i=!1;switch(t.tempData.order.mobileData.category){case"t1":i=!0;break;case"t2":break;case"nuts":}i?t.checkoutStep():t.coverStep()}},coverStep:function(){var e=this,t=e.tempData.order,o={id:t.id,mobile_id:t.mobile_id,pay_type:2};!!t.cdkey_code&&(o.cdkey_code=t.cdkey_code),!!t.discount_amount&&(o.discount_amount=t.discount_amount),$.each(e.tempData.warrantys,function(t,i){var r=0|(e.radioWarranty[i.postName]&&e.radioWarranty[i.postName].choosed().id);r&&(o[i.postName]=e.tempData.order[i.postName]=i.sku)}),e.MobileFittingService.getFitting(e.tempData.order.mobileData.category,e.tempData.mobileVersion).done(function(t){var i=t.fittingStock;if(i){switch(e.tempData.order.mobileData.category){case"nuts":e.UtilService.SMpvEvent("坚果","下一步");break;case"t2":e.UtilService.SMpvEvent("T2","下一步")}e.MobileService.completeTempOrder(o).done(function(e){Store.Router.navigate("accessories/"+o.id+"?fitting",{trigger:!0})})}else{switch(e.tempData.order.mobileData.category){case"nuts":e.UtilService.SMpvEvent("坚果","去结算");break;case"t2":e.UtilService.SMpvEvent("T2","去结算")}e.checkoutStep()}})},checkoutStep:function(){var e=this,t=e.tempData.order,o={id:t.id,mobile_id:t.mobile_id,pay_type:2},i=[],r=[],a={sku:o.mobile_id,num:1,warranty:[]};if(t.safety1&&(a.warranty.push(t.safety1),o.safety1=t.safety1),t.safety2&&(a.warranty.push(t.safety2),o.safety2=t.safety2),a.warranty.length?a.warranty=a.warranty.join(":"):delete a.warranty,r.push(a),!!t.cdkey_code&&(o.cdkey_code=t.cdkey_code),!!t.discount_amount&&(o.discount_amount=t.discount_amount),e.cartQuantity){var n=e.cartQuantity.getAllNum();$.each(n,function(e,t){0!=t.num&&(r.push({sku:e,num:t.num}),i.push(e+":"+t.num))})}o.goods_infos=i.join(","),o.cdkey_code?e.UserService.login(function(){e.MobileService.completeTempOrder(o).done(function(e){Store.Router.navigate("checkout/"+e.id,{trigger:!0})})}):(e.CartService.addCart(r),Store.Router.navigate("cart",{trigger:!0}))},wapOpenChooseFitting:function(e){var t=$(e.currentTarget);t.closest(".js-wap-fitting-operation-section").toggleClass("wap-cover-operation-section-choose",!0)},checkRadio:function(e){var t=$(e.currentTarget),o=$(e.target);t.hasClass("disabled")||o.closest(".blue-radio").length||t.find("input").prop("checked",!0).change()}})}),window.Store.addView("MobileCheckout",function(){return Backbone.View.extend({el:".content",events:{"click .js-online-list li":"checkRadio","click .repic-li":"checkRadio","click .js-choose-invoice li":"checkRadio","click .js-installment-list li":"checkRadio","click .payment-title":"checkRadio"},initialize:function(){var e=this;e.curView=null,e.uiPlugin=Store.getPlugin("UI"),e.verifyPlugin=Store.getPlugin("Verify"),e.MobileService=Store.getService("Mobile"),e.dialogOrderConfirm=new(Store.getView("OrderConfirmDialog")),e.total=0},render:function(e){var t=this,o=(Store.getModel("Address"),new(Store.getView("CheckoutAddress"))({collection:t.collection}));t.curView=e,t.uiPlugin.radio({wrapper:t.$(".payment-title"),name:"payMenuType",checked:"online",callback:function(e,t){var o=(e.closest(".js-payment-wrapper"),e.closest(".module-payment-wrapper")),i=o.siblings(".module-payment-wrapper");o.find(".payment-container").find("input:first").prop("checked",!0).change(),i.toggleClass("payment-container-visible",!1),o.toggleClass("payment-container-visible",!0)}}),t.uiPlugin.radio({wrapper:t.$(".payment-inner"),name:"pay_channel_type",checked:"1",callback:function(e,t){t.wrapper.find(".selected").removeClass("selected"),e.closest("li").addClass("selected")}}),t.uiPlugin.chooseInvoice({styleWrapper:t.$(".js-choose-invoice"),typeWrapper:t.$(".repic")}),t.verifyPlugin.bindVerify({wrapper:t.$el,verifyDom:".js-verify",button:t.$(".js-checkout"),error:function(e){e.focus()},success:function(i){var r=Store.getData(t.$el),a=/^(\d)\_(\d+)$/;if(o.isUseForm){var n=t.$(".js-address-area-code").val(),s=t.$(".js-address-telephone").val();if(n!=s&&(""==n||""==s))return""==n&&i.thrown(t.$(".js-address-area-code"),"必填",!0),""==s&&i.thrown(t.$(".js-address-telephone"),"必填",!0),!1;r.province_name=t.$(".js-form-province").children(":checked").text(),r.city_name=t.$(".js-form-city").children(":checked").text(),r.district_name=t.$(".js-form-district").children(":checked").text(),r.address_id=0}else $.extend(r,t.collection.get({id:r.address_id}).toJSON());var c=r.pay_channel_type.match(a);"string"==typeof r.pay_channel_type&&c&&(r.pay_channel_type=c[1],"installment"==r.payMenuType?r.ped_cnt=c[2]:r.bank=c[2]);var l=$.extend({},r,e.tempData.curOrder);l.isPreorder=!0,Store.config.isMobile?t.createOrder(l).done(function(e){Store.Router.navigate("confirm/"+e.order_id,{trigger:!0})}).fail(function(e){console.log(e)}):t.dialogOrderConfirm.render(l,function(){return t.createOrder(l)})}}),o.render()},createOrder:function(e){var t=this,o={id:e.id,mobile_id:e.mobile_id,pay_type:e.pay_type,cdkey_code:e.cdkey_code,safety1:e.safety1,safety2:e.safety2,discount_amount:e.discount_amount||0,invoice_style:e.invoice_style,invoice_type:e.invoice_type,invoice_title:e.invoice_title,pay_channel_type:e.pay_channel_type,address_id:e.address_id};return e.bank&&(o.bank=e.bank),e.ped_cnt&&(o.ped_cnt=e.ped_cnt),o.accept_name=e.accept_name,o.street=e.street,o.post_code=e.post_code,o.province_code=e.province_code,o.city_code=e.city_code,o.district_code=e.district_code,o.mobile=e.mobile,o.area_code=e.area_code,o.telephone=e.telephone,o["default"]=e["default"],t.MobileService.createOrder(o)},checkRadio:function(e){var t=$(e.currentTarget),o=$(e.target);o.closest(".blue-radio").length||t.find("input").prop("checked",!0).change()}})}),window.Store.addView("Item",function(){return Backbone.View.extend({el:".content",events:{"click .js-add-cart, .add-cart":"addToCart","click .thumbnail li a":"changeThumbnail","click .js-on-cart":"jumpToCart","click .js-off-cart":"hideCartTipDiag","click .sku-dynamic-params ul li":"chooseParams","click .thumb-pre, .thumb-next":"preNextThumbnail","click .js-add-customize, .add-cart-customize":"addCustomize","click .js-checkout-btn":"easterCheckout"},initialize:function(){var e=this;e.dialogPlugin=Store.getPlugin("Dialog"),e.model=new(Store.getModel("Sku")),e.cartService=Store.getService("Cart"),e.categoryService=Store.getService("Category"),e.UserService=Store.getService("User"),e.OrderService=Store.getService("Order"),e.UtilService=Store.getService("Util"),e.scrollFixedNav()},render:function(e,t){{var o=this;o.$el.find(".item-wrapper")}o.tempData=t;new(Store.getView("CartQuantity"))({el:o.$el});o.model.set(e.tempData.sku),o.alignMiddle(),o.renderSpecPanel()},alignMiddle:function(){var e=$(".selection").height(),t=Math.floor((530-e)/2)+"px";$(".selection").css({"padding-top":t})},renderSpecPanel:function(){var e=this,t=e.$el.find(".sku-dynamic-params-panel"),o=e.model.get("spu_spec_list"),i=e.model.get("sku_list"),r=e.model.get("sku"),a=e.categoryService.getSpecList(o,i,r),n=!0;$.each(a,function(o,i){return e.tempData.sku.is_doodle&&"颜色"==i.name?(n=!1,t.remove(),!1):void 0}),n&&t.html(ct.compile(ct.get("templateDynamicSpec",!0),{data:a}))},chooseParams:function(e){var t,o=this,i=$(e.currentTarget),r={},a=o.model.get("sku_list"),n="";if(!i.hasClass("cur")&&!i.hasClass("soldout")){i.toggleClass("cur",!0).siblings().toggleClass("cur",!1),t=o.model.get("sku"),a=o.model.get("sku_list");var s={key:i.data("name"),val:i.data("value")};r=o.categoryService.getCurrentSku(a,t),n=o.categoryService.getUpdateSkuID(a,r,s.key,s.val),n&&o.navigateToSku(n)}},renderGallery:function(){var e=this,t=e.$el.find(".gallery");t.html(ct.compile(ct.get("tempItemGallery",!0),{sku:e.model.toJSON()}))},renderSkuinfo:function(){var e=this,t=e.$el.find(".selection");t.html(ct.compile(ct.get("tempItemInfo",!0),{sku:e.model.toJSON(),postageTerm:Store.config.postageTerm,easterData:e.tempData.easterData}))},renderFixbar:function(){var e=this,t=e.$el.find(".fixed-nav-inner");t.html(ct.compile(ct.get("tempItemFixbar",!0),{sku:e.model.toJSON(),easterData:e.tempData.easterData}))},easterCheckout:function(){var e=this,t=e.model.toJSON();e.cartService.addCart({sku:t.sku,num:1}).done(function(t){t?Store.Router.navigate("cart",{trigger:!0}):e.dialogPlugin.message({message:"此商品已下架或暂无库存"})})},addToCart:function(){var e=this,t=e.$el.find(".cart-tip-diag"),o=parseInt(e.$el.find(".js-select-quantity .num input").val(),10);if(e.model.get("limit_num")<o)return void e.dialogPlugin.message({message:"您购买的产品超出数量上限，请重新选择。"});var i=e.model.toJSON();e.cartService.addCart({sku:i.sku,num:o}).done(function(o){o?(e.$el.find(".fixed-nav").is(":visible")?t.removeClass("absolute").addClass("fixed"):t.removeClass("fixed").addClass("absolute"),t.stop(!0,!1).fadeIn({duration:100})):e.dialogPlugin.message({message:"此商品已下架或暂无库存"})})},addCustomize:function(){var e=this;e.dialogPlugin.message({messageClass:"module-dialog-item-warning",message:'<p class="text-left">这款背壳已经售完，但你仍可以追加定制此背壳。</p><p class="text-left">1. 追加定制的发货周期在 2 周 ~ 3 周;</p><p class="text-left">2. 追加定制的价格会比原价高 20%。</p>',done:function(t){t.close();var o={carts:[],isDoodle:!0},i=parseInt(e.$el.find(".js-select-quantity .num input").val(),10);o.carts.push({id:e.model.get("sku"),num:i}),e.UserService.login(function(){e.OrderService.createTempOrder(o).done(function(e){Store.Router.navigate("#/checkout/"+e.id,{trigger:!0})})})}})},hideCartTipDiag:function(){var e=this,t=e.$el.find(".cart-tip-diag");t.is(":visible")&&t.stop(!0,!1).fadeOut({duration:100})},jumpToCart:function(){Store.Router.navigate("cart",{trigger:!0})},changeThumbnail:function(e){var t=this,o=t.$el.find(".thumbnail"),i=$(e.target).closest("li"),r=o.find("li").index(i);t.activeThumbnail(r)},preNextThumbnail:function(e){var t=this,o=$(e.currentTarget).prop("name"),i=t.$el.find(".thumbnail"),r=i.find("li").length-1,a=i.find("li.on").index();switch(o){case"pre":t.activeThumbnail(a>0?a-1:r);break;case"next":t.activeThumbnail(r>a?a+1:0)}},activeThumbnail:function(e){var t=this,o=t.$el.find(".thumb"),i=t.$el.find(".thumbnail");o.find("li").eq(e).stop(!0,!1).animate({opacity:1},300).show().siblings().stop(!0,!1).animate({opacity:0},300).hide(),i.find("li").removeClass("on").eq(e).addClass("on")},jumpParamsPart:function(e){var t=this,o=$(e.target).parent(),i=o.closest(".js-params-nav").find("li").index(o),r=t.$el.find(".item-params-box .anchor-to").eq(i).offset().top;$("html, body").animate({scrollTop:r},"slow")},scrollFixedNav:function(e){var t=this,o=0,i=[],r=$(".fixed-nav");$(window).scroll(function(){t.hideCartTipDiag(),o=$(this).scrollTop(),t.$el.find(".item-params-box .anchor-to").each(function(e,t){i[e]=$(t).offset().top-80}),o>i[0]?r.stop(!0,!1).animate({opacity:1},100).show():r.stop(!0,!1).animate({opacity:0},100,function(){r.hide()})})},navigateToSku:function(e){var t=this;t.categoryService.getSku(e).done(function(o){o.store_nums=o.store_nums||0,t.tempData.easterData.curGoods=t.tempData.easterData.keyMap[e]?t.tempData.easterData.keyMap[e]:void 0,t.model.set(o),t.renderGallery(),t.renderSkuinfo(),t.renderSpecPanel(),t.renderFixbar();{var i=[];o.category}i.push({nav:"精品配件",url:"#/category/?id=0"},{nav:o.name,url:""}),t.$("h1").text(o.name),Store.Router.initBreadcrumb(i),Store.Router.setTitle(o.name+" - Smartisan")}),Store.Router.navigate("/item/"+e,{replace:!0})},chooseColor:function(e){var t=$(e.target),o=t.text(),i=t.css("background-color");t.closest("li").css("border","2px solid "+i).siblings().css("border","2px solid #fff"),t.closest(".color").find("p span").text(o)},saleOut:function(){var e=this;e.$el.find(".selection .color li").find(".selection .color li a").css("cursor","not-allowed"),e.$el.find(".selection .color p span").text("")}})}),window.Store.addService("Theme",function(e,t){function o(){}return o.prototype.init=function(){},o.prototype.pageConfig=function(){var e={promotions:{prod:[{className:"jbl-e10",sku:"100000905",name:"JBL E10 线控通话入耳机",price:328},{className:"jbl-e30",sku:"100001105",name:"JBL E30 头戴式便携 HiFi 耳机",price:499},{className:"jbl-e40bt",sku:"100001304",name:"JBL E40BT 头戴式蓝牙 HiFi 耳机",price:699},{className:"jbl-pulse",sku:"100001801",name:"BL PULSE 炫彩脉动蓝牙音箱",price:1699},{className:"sennheiser-urbanite-xl",sku:"100001402",name:"JBL J406 商务蓝牙耳机",price:280}]},jbl:{prod:[{className:"jbl-e10",sku:"100000905",name:"JBL E10 线控通话入耳机",price:328},{className:"jbl-e40bt",sku:"100001304",name:"JBL E40BT 无线蓝牙传输便携式耳机",price:699},{className:"jbl-pulse",sku:"100001801",name:"声光结合无线蓝牙传输便携式音响",price:1699},{className:"jbl-s400bt",sku:"100001002",name:"带有触控科技的 无线蓝牙传输高端便携式耳机",price:1580},{className:"jbl-s700",sku:"100005401",name:"发烧级头戴式耳机 可配线控线材",price:2480,status:2},{className:"jbl-voyager",sku:"100001901",name:"家庭音频系统 和便携无线扬声器的结合",price:1999}]},fidelio:{prod:[{className:"fidelio-p9x",sku:"100004701",name:"Fidelio P9X 8 单元无线蓝牙音箱",price:1650},{className:"fidelio-l2",sku:"100004301",name:"Fidelio L2 头戴式监听 HiFi 耳机",price:1200},{className:"fidelio-s2",sku:"100004501",name:"Fidelio S2 高端入耳式耳机",price:599},{className:"fidelio-ds9800",sku:"100004601",name:"Fidelio DS9800 HiFi 无线蓝牙音箱",price:6999},{className:"fidelio-m1bt",sku:"100004002",name:"Fidelio M1BT 封闭式 HiFi 耳机",price:1099},{className:"fidelio-x1",sku:"100004201",name:"Fidelio X1 开放式高保真 HiFi 耳机",price:1200}]}};return e},o.prototype.shareWeibo=function(e,t,o){var t="http://service.weibo.com/share/share.php?appkey=&title="+e+"&url="+encodeURIComponent(t)+"&pic="+o;return t},o.prototype.shareQzone=function(e,t,o,i,r){var t="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+e+"&url="+encodeURIComponent(t)+"&desc="+i+"&summary="+r+"&pics="+o;return t},o.prototype.getCoverData=function(e){var o=this,i=[],r=!1;t.isArray(e)?r=!0:e=[e];for(var a=0,n=e.length;n>a;a++){var s=e[a],c=t.config.storeUrl+"item/"+s.skuId;s.is_custom=0|s.is_custom,s.status=0|s.status,s.doodleImg=s.doodle_images&&s.doodle_images["2x"]&&s.doodle_images["1x"]?t.config.isRetina?s.doodle_images["2x"]:s.doodle_images["1x"]:t.filter.realImage(s.img,300);var l="";if(s.is_custom)l="追加定制",s.store_nums_out=!1;else switch(s.status){case 1:s.remain<=0?(s.remain=0,l="暂时无货",s.store_nums_out=!0):s.store_nums_out=!1;break;case 2:l="即将发售",s.store_nums_out=!0;break;default:l="暂时无货",s.store_nums_out=!0}s.buttonLabel=l,s.thumbContent=o.getLimitContent(s.skuId,s.content,110),s.shareWeibo=o.shareWeibo(s.share_text,c,s.share_pic),i.push(s)}return i},o.prototype.getLimitMarkdownContent=function(e,o,i){var r=o,a=document.location.origin+"/#/item/"+e;return i=i||110,r=t.filter.ellipsis(o,i),r+="······[查看完整故事 >]("+a+")"},o.prototype.getLimitContent=function(e,o,i){var o=o+"",r="";return r=t.filter.ellipsis(o,i),r=r.replace(/\.+$/,"······")},o.prototype.getDoodles=function(e){var t=this;return mainService.ajax({url:"Doodle/GetGoodsList",data:e,success:function(e){return e.list=t.getCoverData(e.list),e}})},new o}(jQuery,window.Store)),window.Store.addView("Easter",function(){return Backbone.View.extend({el:".content",events:{"click [data-floor]":"chooseFloor","click [data-return]":"returnTop","mousedown .js-egg-panel":"brokenEgg"},initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.dialogPlugin=Store.getPlugin("Dialog"),e.GoodsService=Store.getService("Goods"),e.EasterService=Store.getService("Easter"),e.UserService=Store.getService("User")},render:function(e,t){var o=this;o.tempData=t,o.$hour01=o.$(".js-hour01"),o.$hour02=o.$(".js-hour02"),o.$minute01=o.$(".js-minute01"),o.$minute02=o.$(".js-minute02"),o.$second01=o.$(".js-second01"),o.$second02=o.$(".js-second02"),o.bindFixBar(),o.chountdown()},bindFixBar:function(){var e=this,t=e.$(".js-easter-sidebar"),o=t.find("[data-floor]"),i=t.find('[data-floor="mobile"]'),r=t.find('[data-floor="smartisan"]'),a=t.find('[data-floor="headset"]'),n=t.find('[data-floor="cover"]'),s=e.$('[data-panel="mobile"]'),c=e.$('[data-panel="smartisan"]'),l=e.$('[data-panel="headset"]'),u=e.$('[data-panel="cover"]'),d=s.offset().top-20,g=c.offset().top-20,p=l.offset().top-20,m=u.offset().top-20;$(window).scroll(function(){var e=$(this).scrollTop();e>482?t.css("top",e-172):t.css("top",310),o.toggleClass("selected",!1),e>=d&&g>e?i.toggleClass("selected",!0):e>=g&&p>e?r.toggleClass("selected",!0):e>=p&&m>e?a.toggleClass("selected",!0):e>=m&&n.toggleClass("selected",!0)})},chooseFloor:function(e){var t=this,o=$(e.currentTarget),i=o.data("floor"),r=t.$('[data-panel="'+i+'"]'),a=r.offset().top;$("html,body").animate({scrollTop:a-20},{queue:!1,duration:1e3,easing:"easeOutQuart"})},returnTop:function(){$("html,body").animate({scrollTop:$("body").offset().top},{queue:!1,duration:1e3,easing:"easeOutQuart"})},chountdown:function(){var e=this;if(!e.tempData.status.next||e.tempData.status.on)return!1;var t=e.tempData.status.next-e.tempData.status.now;t=Math.floor(t/1e3),Store.loop.easter=setInterval(function(){if(0>=t)clearInterval(Store.loop.easter),Backbone.history.loadUrl();else{t--;var o=Store.filter.realtime(t,"date").split(":"),i=o[1].split(""),r=o[2].split(""),a=o[3].split("");e.$hour01.removeClass().addClass("time-num time-num-"+i[0]),e.$hour02.removeClass().addClass("time-num time-num-"+i[1]),e.$minute01.removeClass().addClass("time-num time-num-"+r[0]),e.$minute02.removeClass().addClass("time-num time-num-"+r[1]),e.$second01.removeClass().addClass("time-num time-num-"+a[0]),e.$second02.removeClass().addClass("time-num time-num-"+a[1])}},1e3)},brokenEgg:function(e){var t=this,o=$(e.currentTarget),i=o.find(".js-egg-crack"),r=o.data("sku"),a=0|o.data("lv"),n=0|o.data("broken"),s=o.find(".js-egg-price"),c=s.find(".js-sell-price"),l=0;switch(r){case"t2":l=t.tempData.easterData.t2.price;break;case"jianguo":l=t.tempData.easterData.jianguo.price;break;default:l=t.tempData.easterData.keyMap[r].price}return n?(s.toggleClass("egg-jump-price",!1).show().delay(0).toggleClass("egg-jump-price",!0),!1):3==a?(c.text(l),o.toggleClass("egg-broken",!0),o.data("broken",1),t.EasterService.brokenEgg(r),!1):(i.toggleClass("egg-crack-"+ ++a,!0),void o.data("lv",a))}})}),window.Store.addModel("Category",function(){return Backbone.Model.extend({defaults:{category_id:"",name:"",img_url:""}})},!1),window.Store.addCollection("CategoryCollection",function(){return Backbone.Collection.extend({model:Store.getModel("Category")})},!0),window.Store.addService("Category",function(e,t){function o(){var e=this;e.CategoryModel=null,e.cacheCategoryList=null,e.MobileGoodsService=null}return o.prototype.init=function(){var e=this;e.CategoryModel=new(t.getModel("Category")),e.MobileGoodsService=t.getService("MobileGoods")},o.prototype.getCategoryList=function(){var e=this;if(e.cacheCategoryList){var o=[].concat(e.cacheCategoryList);return t.proxyDefer({list:o})}return mainService.ajax({url:"goods/GetCategoryList",success:function(t){return e.cacheCategoryList=t.list,t}})},o.prototype.getCategory=function(e,t,o){var i={page_size:20};return e&&(i.category_id=e),t&&(i.page=t),o&&(i.sort=o),mainService.ajax({url:"goods/GetGoodsList",data:i,success:function(e){var t=4-e.list.length%4;t=4==t?0:t;for(var o=0,i=t;i>o;o++)e.list.push({placeholder:!0});return e}})},o.prototype.getSku=function(o){var i=this;return mainService.ajax({url:"goods/GetSingleSkuInfo",data:{sku:o},success:function(o){var r=0|o.status,a=o.store_nums,n="",s=e.extend({},o);if(o.is_custom=0|o.is_custom,o.is_doodle=0|o.is_doodle,o.is_custom)n="追加定制",s.store_nums_out=!1;else switch(r){case 1:0>=a?(s.store_nums=0,n="该商品已售罄",s.store_nums_out=!0):s.store_nums_out=!1;break;case 2:n=o.is_doodle?"即将发售":"该商品已下架",s.store_nums_out=!0;break;default:n="该商品已售罄",s.store_nums_out=!0}s.statusLabel=n,s.category=s.crumbs.pop(),s.detail_md=[],t.isArray(o.detail_md)&&e.each(o.detail_md,function(e,t){s.detail_md.push({title:t.title,content:marked(t.mdContent)})}),s.detailImage=t.config.isRetina?s.spu_content["2x"]:s.spu_content["1x"];var c=i.MobileGoodsService.mapCovers;return s.isDiscountGoods=t.config.useGoodsDiscount&&!!c[s.sku]&&"t2"!=c[s.sku].category,s},error:function(){return!1}})},o.prototype.getSkuBySpec=function(e){return mainService.ajax({url:"goods/GetSKUBySpec",data:e,success:function(e){return e},error:function(){return!1}})},o.prototype.getSpecList=function(t,o,i){var r=this,a={};a=_.find(o,function(e){return e.sku==i});var n=[].concat(o),s=[];e.each(t,function(t,i){var c=[];e.each(i.value,function(e,t){var s=_.find(o,function(e){return e.spec_list[i.spec_id]&&e.spec_list[i.spec_id].spec_value==t});s&&c.push({key:i.spec_id,value:s.spec_list[i.spec_id],soldout:r.isSoldout(n,i.spec_id,t),isExist:r.isExist(n,a,i.spec_id,t),selected:a.spec_list[i.spec_id].spec_value==t})}),s.push(c),n=r.findSkus(n,i.spec_id,a.spec_list[i.spec_id].spec_value,"getSpecList")});var c=[];return _.each(t,function(e,t){var o={name:e.name,item:s[t],cur:""},i=_.find(o.item,function(e){return 1==e.selected});i&&(o.cur=i.value.spec_value),c.push(o)}),_.each(c,function(e,t){e.isColor="颜色"==e.name}),c},o.prototype.isSoldout=function(t,o,i){var t=[].concat(t),r=!0;return e.each(t,function(e,t){return t.spec_list[o]&&t.spec_list[o].spec_value==i&&!t.sold_out&&t.is_sell?(r=!1,!1):void 0}),r},o.prototype.isExist=function(t,o,i,r){var a=this,n=[].concat(t),s=[],c=!0;return e.each(o.spec_list,function(e,t){s.push(t.spec_id==i&&t.spec_value!=r?{key:i,value:r}:{key:t.spec_id,value:t.spec_value})}),e.each(s,function(e,t){return n=a.findSkus(n,t.key,t.value,"isExist"),n.length?void 0:(c=!1,!1)}),c},o.prototype.findSkus=function(t,o,i,r){var t=[].concat(t),a=[];return e.each(t,function(e,t){t.spec_list[o].spec_value==i&&a.push(t)}),a},o.prototype.getSkuColorClass=function(e){switch(e){case"黑色":return"black";case"白色":return"white";case"灰色":return"gray";case"红色":return"red";case"玛瑙黑":return"onyx-black";case"海波绿":return"hyperion-green";case"陨石灰":return"meteorite-gray";case"干邑红":return"cognac-red";case"可乐红":return"coke-red";case"香槟金":return"champagne-gold";case"冰川蓝":return"glacier-blue";case"蓝灰色":return"blue-gray";case"青柠色":return"lime";case"粉红色":return"pink";case"蓝青色":return"cyan";case"海军蓝":return"navy-blue";case"紫罗兰":return"violet";case"典雅黑":return"elegant-black";case"蓝绿色":return"blue-green";case"银色":return"silver";case"绿色":return"green";case"黄色":return"yellow";case"墨绿色":return"dark-green";case"褐色":return"brown";case"深蓝色":return"dark-blue";case"浅蓝色":return"light-blue";case"橙色":return"orange";case"黑灰色":return"black-gray";case"棕色":return"brown";case"紫色":return"purple";case"蓝色":
return"blue"}},o.prototype.getCurrentSku=function(t,o){var i={},t=[].concat(t);return e.each(t,function(e,t){return t.sku==o?(i=t,!1):void 0}),i},o.prototype.getUpdateSkuID=function(t,o,i,r){var a=this,n=[].concat(t),s={},c="";return e.each(o.spec_list,function(e,t){s[e]=e==i?r:t.spec_value}),e.each(s,function(e,t){n=a.findSkus(n,e,t)}),n.length&&(c=n[0].sku),c},o.prototype.getSkuIdBySkulist=function(t,o,i){var t=[].concat(t),r=[];return e.each(t,function(e,t){t.spec_list[o]==i&&r.push(t)}),r},new o}(jQuery,window.Store)),window.Store.addView("Category",function(){return Backbone.View.extend({el:".content",events:{"click .sort-option h5":"toggleSortOption","click .sort-option a":"sort"},initialize:function(){var e=this;e.PagingPlugin=Store.getPlugin("Paging"),e.categoryService=Store.getService("Category"),e.paging=null,e.categoryID=null,e.sortType="sort"},render:function(e,t,o,i,r,a){var n=this;n.maxPageCount=e.tempData.category.page_count,n.tempData=t,n.view=e,a&&n.$(".sku-box h2").text(a.name),n.categoryID=o,n.sortType=r,n.paging=n.PagingPlugin.render({$wrapper:n.$(".js-category-paging"),useLink:!0,href:"#/category/?id="+n.categoryID+"&sort="+n.sortType+"&page=",data:{count:e.tempData.category.count,page_count:n.maxPageCount,page:i}})},updateView:function(e){var t=this,o={page:1,sort:t.sortType};return e.list.id?(t.updateCategoryMenu(e.list.id.value),!1):(e.list.page&&(o.page=e.list.page.value),void(e.list.sort?(o.sort=e.list.sort.value||t.sortType,o.page=1,t.updateSortMenu(o.sort)):t.renderSkubox(o.page,o.sort)))},updateCategoryMenu:function(e){{var t=this,o={id:0,name:"全部商品"};_.findWhere(t.categoryService.cacheCategoryList,{id:e})||o}t.categoryID=e,Store.Router.subNav.selectCategory(e),t.updateSortMenu("sort")},updateSortMenu:function(e){var t=this,e=e||t.sortType,o=t.$(".sort-option ul"),i=o.find('[data-type="'+e+'"]');i.length||(e="sort",i=o.find('[data-type="sort"]'),Store.replaceUrl("sort","sort")),t.sortType=e,o.siblings("h5").text(i.data("label")),o.find("li a").toggleClass("active",!1),i.toggleClass("active",!0),t.renderSkubox(1,e)},sort:function(e){e.preventDefault();var t=this,o=(t.$(".sort-option ul"),$(e.currentTarget)),i=o.data("type");t.sortType=i;var r="#/category/?id="+t.categoryID+"&sort="+t.sortType;Store.Router.navigate(r,{trigger:!0})},renderSkubox:function(e,t){var o=this,i=o.maxPageCount,t=t||o.sortType,e=e>0&&i>=e?e:1,r=o.$(".sku-box .gray-box");$(window).scrollTop(0),o.sortType=t,o.categoryService.getCategory(o.categoryID,e,t).done(function(t){o.paging&&(o.paging.setHref("#/category/?id="+o.categoryID+"&sort="+o.sortType+"&page="),o.maxPageCount=t.page_count,o.paging.pageCount=t.page_count,o.paging.reset(e)),r.empty(),r.append(ct.compile(ct.get("templateSkubox",!0),{category:t},!0))})},toggleSortOption:function(){var e=this,t=e.$el.find(".sort-option");return t.hasClass("on")?!1:(t.toggleClass("on",!0),void setTimeout(function(){$(document).on("click",function(){t.is(".on")&&(t.toggleClass("on",!1),$(document).off("click"))})},50))}})}),window.Store.addModel("CartItem",function(){return Backbone.Model.extend({defaults:{id:"00001",num:1,image:"img/i.gif",remove:!1,children:[]}})}),window.Store.addCollection("Cart",function(){return Backbone.Collection.extend({model:Store.getModel("CartItem")})},!0),window.Store.addService("Cart",function(e,t){function o(){var e=this;e.CartModel=null,e.CartCollection=null,e.MobileGoodsService=null,e.GoodsService=null,e.carts=[],e.cache={},e.phones={},e.fetchData={},e.fetchLoop=null,e.loopTime=[]}return o.prototype.init=function(){var o=this;o.CartCollection=t.getCollection("Cart",[]),o.MobileGoodsService=t.getService("MobileGoods"),o.GoodsService=t.getService("Goods");var i=e.cookies.filter("^ct");e.each(i,function(t,o){e.cookies.del(t)})},o.prototype.syncList=function(){var o=this,i=[],r=e.cookies.filter("^ct");clearInterval(o.fetchLoop),o.fetchLoop=null,e.each(r,function(t,o){var r=t.replace(/^ct/,""),a=e.cookies.get("cw"+r);r&&"undefined"!=r&&i.push(a?r+":"+a+":"+Math.max(o,1):r+":"+Math.max(o,1))});var a={};return i.length&&(a.goods=i.join(",")),mainService.ajax({url:"ShoppingCart/Sync",data:a,success:function(o){var i;try{i=t.filter.nextDate(30)}catch(r){}return e.each(o,function(o,r){e.cookies.set("ct"+r.goods_code,r.goods_num,{expiresAt:i,domain:"smartisan.com"}),t.isArray(r.extended)&&r.extended.length&&e.cookies.set("cw"+r.goods_code,r.extended.join(":"),{expiresAt:i,domain:"smartisan.com"})}),o},error:function(){return!1}})},o.prototype.getLocalList=function(o){var i=this,o=(i.MobileGoodsService.mapWarrantys,o||[]),r=e.cookies.filter("^ct");return e.each(r,function(e,t){o.push(e.replace(/^ct/,""))}),o.length?i.GoodsService.getSimpleDetail(o).then(function(t){var o={on_sell_list:[],off_sell_list:[]};return e.each(r,function(r,a){var n=r.replace(/^ct/,""),s=t[n];if(s){if(s.num=0|a,s.isMobile&&(s.isAccident=0,s.isDelay=0),s.isMobile&&e.cookies.get("cw"+s.sku)){s.warranty=e.cookies.get("cw"+s.sku);var c=(s.warranty+"").split(":");e.each(c,function(e,t){var o=s.accessoryGoods[t];o&&("accident"==o.aliases&&(s.isAccident=1),"delay"==o.aliases&&(s.isDelay=1))})}i.syncCollection(s),s=i.CartCollection.get({id:s.sku}).toJSON(),s.isSell?o.on_sell_list.push(s):o.off_sell_list.push(s)}}),o.on_sell_list=i.formatOnlineCart(o.on_sell_list),o}):(i.removeCollection(),t.proxyDefer({on_sell_list:[],off_sell_list:[]}))},o.prototype.getRecommendedProds=function(){var e=this,o=t.config.recommendedProds;return e.getProdInfo(o)},o.prototype.getFeatureList=function(e){var t=this;return mainService.ajax({type:"get",url:"product/featured",isNode:!0,data:{pos_ids:e},success:function(o){return t.GoodsService.parseCommonData(o[e],{imgSize:258})}})},o.prototype.getProdInfo=function(o){for(var i=this,r=o&&o.constructor===Array?o:(o+"").split(","),a=[],n={},s=0,c=r.length;c>s;s++)i.cache[r[s]]?n[r[s]]=e.extend({},i.cache[r[s]]):a.push(r[s]);return a.length?mainService.ajax({url:"goods/GetSkusInfo",data:{goods_str:a.join(",")},success:function(t){for(var o=t.list,a=0,s=o.length;s>a;a++)o[a].max=o[a].limit_num||5,o[a].price=o[a].sell_price,i.cache[o[a].sku]||(i.cache[o[a].sku]=o[a],n[o[a].sku]=o[a]);for(var a=0,s=r.length;s>a;a++)i.cache[r[a]]||e.cookies.del("ct"+r[a],{domain:"smartisan.com"});return n},error:function(e,t,o){return 7e4==e?!1:void 0}}):t.proxyDefer(n)},o.prototype.addCart=function(o,i){var r=this,o=i?{sku:o,num:i}:o,a=t.isArray(o),o=a?o:[o],n=[],s=[];return e.each(o,function(t,o){var i=r.CartCollection.get({id:o.sku}),a=e.cookies.get("ct"+o.sku),c={id:o.sku,sku:o.sku,num:0|o.num};r.MobileGoodsService.mapPhones[c.sku]&&(c.isMobile=!0,c.num=1,c.warranty=o.warranty),i?(c.num+=i.get("num"),c.num=Math.min(c.num,i.get("max")),s.push(c)):a?(c.num+=0|a,s.push(c)):n.push(c)}),s.length&&r.updateCart(s),n.length&&r.insertCart(n),t.proxyDefer(!0)},o.prototype.insertCart=function(t){var o=this,i=[];e.each(t,function(t,r){var a=e.extend({},o.GoodsService.goodsCache[r.sku],{id:r.sku+"",sku:r.sku+"",num:r.num});if(i.push(r.sku),r.isMobile){var n=o.MobileGoodsService.mapPhones[r.sku];a.max=1,a.image=n.image,a.price=n.price,a.subtotal=n.price*r.num,a.isMobile=1,a.warranty=r.warranty}o.syncCollection(a)}),o.fetchCart(t),o.GoodsService.getSimpleDetail(i)},o.prototype.updateCart=function(o){var i=this,r=i.MobileGoodsService.mapPhones,a=i.MobileGoodsService.mapWarrantys,n=t.isArray(o),s=[],o=n?o:[o];e.each(o,function(t,o){if(r[o.sku]){var n=i.CartCollection.get({id:o.sku});n=n?e.extend({},n.toJSON()):e.extend({},o);var c=o.warranty?(o.warranty+"").split(":"):[];n.isAccident=0,n.isDelay=0,n.warranty=[],e.each(c,function(e,t){var o=a[t];o&&("safety1"==o.postName&&(n.isAccident=1,n.warranty.push(t)),"safety2"==o.postName&&(n.isDelay=1,n.warranty.push(t)))}),n.warranty=n.warranty.join(":"),o=e.extend({},n)}s.push(o.sku),i.syncCollection(o)}),i.fetchCart(o),i.GoodsService.getSimpleDetail(s)},o.prototype.fetchCart=function(o,i){var r=this,a=t.isArray(o),o=a?o:[o],n=r.MobileGoodsService.mapPhones,s=(r.MobileGoodsService.mapWarrantys,+new Date);e.each(o,function(e,t){i?delete r.fetchData[t.sku]:(r.fetchData[t.sku]=[t.num],n[t.sku]&&t.warranty&&r.fetchData[t.sku].unshift(t.warranty),r.fetchData[t.sku]=r.fetchData[t.sku].join(":"))}),r.loopTime.push(s),r.fetchLoop=setTimeout(function(){if(s==r.loopTime[r.loopTime.length-1]){var t=[];e.each(r.fetchData,function(e,o){t.push(e+":"+o)}),mainService.ajax({url:"ShoppingCart/Save",data:{goods_code:t.join(",")},error:function(){return!1}}),clearInterval(r.fetchLoop),r.fetchLoop=null}},2e3)},o.prototype.removeCart=function(e){var o=this,i=t.isArray(e),r=i?e:[e];return o.removeCollection(r),mainService.ajax({url:"ShoppingCart/Del",data:{goods_codes:r.join(",")},success:function(e){return e},error:function(){return!1}})},o.prototype.removeAll=function(o){var i=this,r=e.cookies.filter("^ct"),a=[];return e.each(r,function(e,t){a.push(e.replace(/^ct/,""))}),i.removeCollection(),o?t.proxyDefer(!0):mainService.ajax({url:"ShoppingCart/Del",data:{goods_codes:a.join(",")},success:function(e){return e},error:function(){return!1}})},o.prototype.syncCollection=function(o,i){var r=this,a=r.CartCollection.get({id:o.sku}),n={};if(a)n=e.extend({},a.toJSON(),o),n.num=0|n.num,n.num=Math.min(n.max,n.num),n.subtotal=n.price*n.num;else{if(i)return!1;n=e.extend({},o),n.max=n.max||10,n.num=0|n.num||1,n.num=Math.min(n.max,n.num),n.price=n.price||0,n.subtotal=n.price*n.num}var s;try{s=t.filter.nextDate(30)}catch(c){}e.cookies.set("ct"+n.sku,n.num,{expiresAt:s,domain:"smartisan.com"}),n.isMobile&&(n.warranty?e.cookies.set("cw"+n.sku,n.warranty,{expiresAt:s,domain:"smartisan.com"}):e.cookies.del("cw"+n.sku,{domain:"smartisan.com"})),a?a.set(n):r.CartCollection.push(n)},o.prototype.removeCollection=function(o){var i=this,r=!o,a=i.MobileGoodsService.mapPhones,n=t.isArray(o),s=n?o:[o];if(r){var c=e.cookies.filter("^ct|^cw");e.each(c,function(t,o){e.cookies.del(t,{domain:"smartisan.com"})}),i.CartCollection=t.getCollection("Cart",[])}else e.each(s,function(t,o){var r=i.CartCollection.get({id:o});e.cookies.del("ct"+o,{domain:"smartisan.com"}),a[o]&&e.cookies.del("cw"+o,{domain:"smartisan.com"}),r&&i.CartCollection.remove(r)})},o.prototype.countCart=function(o){{var i=this;i.MobileGoodsService.mapPhones}if(!this.CartCollection||!this.CartCollection.length){var r=0,a=e.cookies.filter("^ct"),n=e.cookies.filter("^cw");return e.each(a,function(e,t){r+=0|t}),e.each(n,function(t,o){var i=(o+"").split(":").length;r+=i*e.cookies.get(t.replace("cw","ct"))}),{num:r,carts:[],total:0}}var s=0,c=0,l=(i.MobileGoodsService.mapCovers,0),u=0,a=o?[]:i.CartCollection&&i.CartCollection.length?i.CartCollection.toJSON():[];o&&e.each(o,function(e,t){var o=i.CartCollection.where(t,!0);o&&a.push(o.toJSON())}),e.each(a,function(e,t){t.num=0|t.num,s+=t.price*t.num,c+=t.num,t.isMobile&&(t.isAccident&&t.accident&&(s+=t.accident.price*t.num,c+=t.num),t.isDelay&&t.delay&&(s+=t.delay.price*t.num,c+=t.num)),t.isDiscount&&(l+=t.num)});var d=t.config.goodsDiscount.cover;return t.config.useGoodsDiscount&&l>=d.num&&(u=d.discount*Math.floor(l/d.num),s-=u),{discountTotal:u,discountGoodsNum:l,num:c,carts:a,total:s}},o.prototype.parseSyncData=function(o){var i=this,r=t.isArray(o),o=r?o:[o],a=[];return e.each(o,function(e,t){var o=i.GoodsService.parseCommonData(t);if(o.num=t.goods_num||1,o.isMobile){var r=[];1==t.is_accident&&(o.isAccident=1,r.push(o.accident.sku)),1==t.is_delay&&(o.isDelay=1,r.push(o.delay.sku)),r.length&&(o.warranty=r.join(":"))}i.syncCollection(o),o=i.CartCollection.get({id:o.sku}).toJSON(),a.push(o)}),r?a:a[0]},o.prototype.formatOnlineCart=function(t){var o=[],i=[];return e.each(t,function(e,t){t.isOut?i.push(t):o.push(t)}),[].concat(o).concat(i)},o.prototype.getRecommendList=function(e){return mainService.ajax({url:"goods/GetSkusInfo",data:{goods_str:e.join(",")},success:function(e){return e.list}})},o.prototype.parsePageCartList=function(o){var i=this,r=i.MobileGoodsService.mapCovers,a={mobileList:[],discountList:[],sellList:[],outList:[],offList:[],isEmpty:!(o.on_sell_list.length||o.off_sell_list.length),canCheckout:!1};return o.on_sell_list=t.isArray(o.on_sell_list)?o.on_sell_list:[],o.off_sell_list=t.isArray(o.off_sell_list)?o.off_sell_list:[],a.offList=[].concat(o.off_sell_list),e.each(o.on_sell_list,function(e,o){o.isOut?a.outList.push(o):(a.canCheckout=!0,t.config.useGoodsDiscount&&r[o.sku]&&"t2"!=r[o.sku].category?(o.isDiscountGoods=!0,a.discountList.push(o)):o.isMobile?a.mobileList.push(o):a.sellList.push(o))}),a},new o}(window.jQuery||window.Zepto,window.Store)),window.Store.addModel("Cart",function(){return Backbone.Model.extend({defaults:{},initialize:function(){}})},!0),window.Store.addView("CartMain",function(){return Backbone.View.extend({initialize:function(){var e=this;e.initList=!1,e.isLoading=!0,e.CartService=Store.getService("Cart"),e.MobileGoodsService=Store.getService("MobileGoods"),e.DialogPlugin=Store.getPlugin("Dialog"),e.temp=ct.get("tempMainCart",!0),e.listenTo(e.collection,"change",e.syncList),e.listenTo(e.collection,"add",e.addItem),e.listenTo(e.collection,"remove",e.removeItem)},events:{"click .js-delete-cart":"removeCart",mouseenter:"getList"},render:function(){var e=this,t=e.$el,o=e.collection.toJSON(),i=e.CartService.countCart(),r=[],a=0,n=0,s=0;$.each(o,function(e,t){t.isSell&&(r.push(t),a+=t.num,n+=t.subtotal,t.isMobile&&t.isAccident&&(r.push(t.accident),a+=t.num,n+=t.accident.price*t.num),t.isMobile&&t.isDelay&&(r.push(t.delay),a+=t.num,n+=t.delay.price*t.num),t.isDiscount&&(s+=t.num))});var c=Store.config.goodsDiscount.cover;if(Store.config.useGoodsDiscount&&s>=c.num){var l=c.discount*Math.floor(s/c.num);n-=l}o.length||(a=i.num),t.html(ct.compile(e.temp,{isLoading:e.isLoading,num:a,carts:r,total:n}))},getList:function(e){var t=this;t.initList||(t.initList=!0,t.CartService.syncList().done(function(e){t.getGoodsList()}).fail(function(){t.getGoodsList()}))},getGoodsList:function(){var e=this;e.CartService.getLocalList().always(function(){e.isLoading=!1}).done(function(t){e.render()})},removeCart:function(e){var t=this,o=$(e.currentTarget),i=o.closest("li"),r=i.data("id");t.DialogPlugin.confirm({message:"您确认删除该商品吗？",notWarning:!0,cancelText:"返回",doneText:"是",ok:function(e){var o=i.data("mobile"),a=t.collection.get({id:o});if(o&&a&&t.MobileGoodsService.mapWarrantys[r]){var n=a.toJSON(),s={sku:o,num:n.num,warranty:n.warranty?n.warranty+"":null};s.warranty&&(s.warranty=s.warranty.replace(r,"").replace(/^\:|\:$/gi,"")),t.CartService.updateCart(s)}else t.CartService.removeCart(r);e.close()}})},syncList:function(e,t){this.render()},addItem:function(){this.render()},removeItem:function(e,t,o){var i=this,r=i.$(".cart-con");r.is(":hidden")?i.render():r.find("ul > li").length>1?i.$("li[data-id="+e.id+"]").animate({height:0,opacity:0,padding:0},{duration:500,easing:"easeOutQuart",complete:function(){i.render()}}):Store.config.opacity?(r.children().animate({opacity:0},400),r.animate({height:172},400),r.find(".empty").show().animate({opacity:1},400,function(){i.render()})):i.render()}})}),window.Store.addView("CartPage",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.$cartBox=e.$(".gray-box:first"),e.$cartInner=e.$(".box-inner:first"),e.$fix=e.$(".cart-bottom-bg"),e.fixBaseTop=e.$fix.offset().top,e.fixTop=0,e.countFixTop(),e.UtilService=Store.getService("Util"),e.UserService=Store.getService("User"),e.CartService=Store.getService("Cart"),e.OrderService=Store.getService("Order"),e.MobileGoodsService=Store.getService("MobileGoods"),e.CartWarrantyDialog=new(Store.getView("CartWarrantyDialog")),e.UI=Store.getPlugin("UI"),e.DialogPlugin=Store.getPlugin("Dialog"),e.listenTo(e.collection,"change:num",e.changeNum),e.listenTo(e.collection,"change:warranty",e.changeWarranty),e.listenTo(e.collection,"remove",e.removeItem),e.discountGoods=e.MobileGoodsService.mapCovers},events:{"click .js-choose-all":"checkBox","click .js-delete-cart":"removeCart","click .js-delete-choose-goods":"removeChooseCart","click .js-del-all-offline":"removeAllOfflineCart","click .js-add-cart":"addCart","click .js-buy-warranty":"addWarranty","click .js-create-order":"createOrder"},countFixTop:function(){var e=this;e.fixTop=e.$fix.offset().top},render:function(e,t){var o=this,i=new(Store.getView("CartQuantity"))({el:o.$el,useData:!0,callback:function(e,t){var i=e.closest(".js-cart-items"),r=i.data("id"),a=o.collection.get({id:r});a=a?a.toJSON():{},o.CartService.updateCart({sku:r,num:t})}});o.tempData=t,o.cartQuantity=i.render(),o.uiCheckboxGoods=o.UI.checkbox({wrapper:o.$cartBox,name:"cart",useAll:!0,allName:"all",callback:function(e){o.countTotal();var t=e.prop("checked"),i=e.closest(".js-cart-items").next(".js-warranty-group");i.length&&i.find(".blue-checkbox").toggleClass("blue-checkbox-on",t)}}),$.each(t.carts.mobileList,function(e,t){o.updateWarranty(t)}),o.$(".js-cart-items").each(function(e){$(this).data("model",o.collection.at(e))}),o.uiCheckboxGoods.allCtrl.on(),o.scrollFixCount(),$(window).on("scroll resize",function(){o.scrollFixCount()})},scrollFixCount:function(){var e=this,t=$(window).scrollTop()+$(window).height(),o=e.$cartBox.offset().top+e.$cartBox.height(),i=e.$cartBox.height()-315,r=0;e.collection.length>1&&o>t&&(r=o-t-1,r=Math.min(r,i)),e.$fix.css("bottom",r)},updateWarranty:function(e){var t=this;if(!e.isSell||e.isOut)return!1;var o=ct.get("tempCartPageListItem",!0),i=ct.get("tempBuyAccident",!0),r=ct.get("tempBuyDelay",!0),a=t.$('.js-cart-items[data-id="'+e.sku+'"]'),n=a.next(".warranty-group"),s=!!_.findWhere(t.uiCheckboxGoods.choosed(),{id:e.sku}),c=e.isAccident?ct.compile(o,{cart:$.extend({},{checked:s},e.accident,{num:e.num,subtotal:e.accident.price*e.num})}):ct.compile(i,e.accident),l=e.isDelay?ct.compile(o,{cart:$.extend({},{checked:s},e.delay,{num:e.num,subtotal:e.delay.price*e.num})}):ct.compile(r,e.delay);n.empty(),n.append(c),e.isDelay&&!e.isAccident?n.prepend(l):n.append(l),t.scrollFixCount()},addWarranty:function(e){var t=this,o=$(e.currentTarget),i=o.data("id"),r=o.data("mobile"),a=t.collection.get({id:r});a&&t.CartWarrantyDialog.render(i,function(){var e=a.toJSON(),o={sku:r,num:e.num},n=[];(e.accident.sku==i||e.isAccident)&&n.push(e.accident.sku),(e.delay.sku==i||e.isDelay)&&n.push(e.delay.sku),o.warranty=n.join(":"),t.CartService.updateCart(o),t.countTotal()})},addCart:function(e){var t=this,o=$(e.currentTarget),i=o.closest(".js-append-cart"),r=t.$cartInner.find(".js-cart-items[data-id="+i.data("id")+"]");r.length?r.find(".up").click():t.CartService.addCart({sku:i.data("id"),num:1})},removeCart:function(e){var t=this,o=$(e.currentTarget),i=o.closest(".js-cart-items"),r=i.data("id");i.data("deling")||t.DialogPlugin.confirm({message:"您确认删除该商品吗？",notWarning:!0,ok:function(e){i.data("deling",!0);var o=i.data("mobile"),a=t.collection.get({id:o});if(o&&a&&t.MobileGoodsService.mapWarrantys[r]){var n=a.toJSON(),s={sku:o,num:n.num,warranty:n.warranty?n.warranty+"":null};s.warranty&&(s.warranty=s.warranty.replace(r,"").replace(/^\:|\:$/gi,"")),t.CartService.updateCart(s)}else t.CartService.removeCart(r);e.close()},cancelText:"返回",doneText:"是"})},removeChooseCart:function(e){var t=this,o=t.uiCheckboxGoods.choosed();t.DialogPlugin.confirm({message:"您确认删除所选中的商品吗？",notWarning:!0,ok:function(e){$.each(o,function(e,o){t.CartService.removeCart(o.id)}),e.close()},cancelText:"返回",doneText:"是"})},removeAllOfflineCart:function(){var e=this,t=$(event.currentTarget),o=t.closest(".gray-box");if(!o.data("deling")){o.data("deling",!0);var i=o.find(".js-cart-items"),r=[];i.each(function(){r.push($(this).data("id"))}),e.CartService.removeCart(r)}},changeWarranty:function(e,t){{var o=this;e.id}o.updateWarranty(e.toJSON()),o.countTotal()},changeNum:function(e,t){{var o=this;e.id}o.$(".js-cart-items[data-id="+e.id+"]").find(".subtotal").text(Store.filter.rmb(e.get("price")*t,!0)),o.countTotal()},removeItem:function(e,t){var o=this,e=e||{},i=o.$(".js-cart-items[data-id="+e.id+"]"),r=i.next(".js-warranty-group"),a=i.closest(".cart-table");if(a.find(".js-cart-items").length>1)r.length&&(i.wrap('<div class="js-del-mobile-wrapper"></div>'),i=i.closest(".js-del-mobile-wrapper"),i.append(r)),e.get("isDiscount")&&!i.siblings(".js-cart-items").length&&(i=i.closest(".js-cart-group")),Store.config.opacity?i.animate({height:0,opacity:0,padding:0},{duration:500,easing:"easeOutQuart",complete:function(){i.siblings(".js-cart-items").length?i.remove():i.closest(".js-cart-group").remove(),a.find(".js-cart-items").length||o.removeItem(),o.countTotal(),o.scrollFixCount()}}):(i.siblings(".js-cart-items").length?i.remove():i.closest(".js-cart-group").remove(),o.countTotal(),o.scrollFixCount());else{var n=ct.compile(ct.get("tempCartPageEmpty",!0),{},!0);Store.config.opacity?(o.$cartInner.height(o.$cartInner.height()),o.$cartInner.children().animate({opacity:0},400,function(){o.$cartInner.animate({height:614},200,function(){o.$cartInner.html(n).height("auto")})}),o.$fix.animate({opacity:0},400,function(){$(this).hide()})):(o.$cartInner.html(n),o.$fix.hide())}},countTotal:function(){var e=this,t=e.uiCheckboxGoods.choosed(),o=e.$(".js-goods-discount-info"),i=e.$(".js-delete-choose-goods"),r=e.cartQuantity.getAllNum(),a=0;$.each(r,function(t,o){e.discountGoods[t]&&a++}),a||o.remove(),i.toggleClass("fn-hide",!t.length);var n=e.CartService.countCart(t);return e.toggleDiscountLabel(n.discountGoodsNum),e.$(".js-discount-subtotal").text("- "+Store.filter.rmb(n.discountTotal,!0)),e.$fix.find(".js-cart-total").text(Store.filter.rmb(n.total,!0)),n},toggleDiscountLabel:function(e){var t=this;Store.config.useGoodsDiscount&&t.$(".js-goods-discount-info").toggleClass("do-animate",e<Store.config.goodsDiscount.cover.num)},createOrder:function(e){var t=this,o=$(e.currentTarget),i=t.MobileGoodsService.mapPhones,r=t.uiCheckboxGoods.choosed(),a=t.cartQuantity.getAllNum();if(o.hasClass("disabled-btn"))return!1;if(r.length){var n={carts:[],mobileGoods:[],isNormal:!0};$.each(r,function(e,o){if(i[o.id]){var r=t.collection.get({id:o.id}).toJSON(),s={id:o.id,num:1,warranty:[]};r.isAccident&&s.warranty.push(r.accident.sku),r.isDelay&&s.warranty.push(r.delay.sku),s.warranty.length?s.warranty=s.warranty.join(":"):delete s.warranty,n.mobileGoods.push(s)}else n.carts.push({id:o.id,num:a[o.id].num})}),t.UserService.login(function(){t.OrderService.createTempOrder(n).done(function(e){Store.Router.navigate("#/checkout/"+e.id,{trigger:!0})})})}else t.DialogPlugin.message({message:"请选择需要购买的商品"})},checkBox:function(e){var t=$(e.currentTarget),o=$(e.target);if(!o.closest(".blue-checkbox").length){var i=t.find("input"),r=i.prop("checked");i.prop("checked",!r).change()}}})}),window.Store.addService("Order",function(e,t){function o(){var e=this;e.OrderParseService=null,e.CartService=null,e.OrderCollection=null,e.StorageService=null}return o.prototype.init=function(){var e=this;e.OrderParseService=t.getService("OrderParse"),e.CartService=t.getService("Cart"),e.StorageService=t.getService("LocalStorage")},o.prototype.parseTempOrderParams=function(e){var o={};return e.cdkey_code&&(o.c=e.cdkey_code),e.discount_amount&&(o.d=e.discount_amount),e.goods_infos&&(o.g=e.goods_infos),t.formatJSONToHash(o)},o.prototype.createTempOrder=function(o){var i=this,r="eo"+(new Date).getTime(),a=[],n=[];e.each(o.carts,function(e,t){n.push(t.id+":"+t.num)}),e.each(o.mobileGoods,function(e,t){var o=[t.id];!!t.warranty&&o.push(t.warranty),o.push(t.num),a.push(o.join(":"))});var s={id:r,mobileGoods:a.join(","),goods_infos:n.join(","),isDoodle:o.isDoodle};return i.removeCache(function(){e.cookies.set(r,s)}),t.proxyDefer(s)},o.prototype.createOrder=function(o){var i=this,r=o.id,a="Order/Create",n=o.goods_infos.split(",");return o.source=11,delete o.id,mainService.ajax({url:a,data:o,success:function(o){if(i.StorageService.remove(r,{domain:"smartisan.com"}),t.isArray(n)){var a=[];e.each(n,function(e,t){a.push(t.split(":")[0])}),i.CartService.removeCart(a)}return o}})},o.prototype.getList=function(e){var o=this;return e.page_size=10,"all"==e.status&&delete e.status,"quarter"==e.time&&delete e.time,mainService.ajax({url:"Order/ListByLogin",data:e,success:function(e){return e.list=o.OrderParseService.parseOrderList(e.list),o.OrderCollection=t.getCollection("Order",e.list),e}})},o.prototype.canBuyInsurances=function(e){return mainService.ajax({url:"Order/CanBuyInsurances",data:{order_id:e},error:function(e,t,o){return 10004==e||1e3==e?!1:void 0}})},o.prototype.getDetail=function(e){var o=this;return mainService.ajax({url:"Order/Detail",data:{order_id:e},success:function(e){return t.isArray(e)&&!e.length||!e?!1:o.OrderParseService.parseOrder(e)}})},o.prototype.getSimpleDetail=function(e){var o=this;return mainService.ajax({url:"Order/SimpleDetail",data:{order_id:e},success:function(e){return t.isArray(e)&&!e.length||!e?!1:o.OrderParseService.parseOrder(e)}})},o.prototype.canUpdate=function(){return mainService.ajax({url:"Auth/VerifyEdit"})},o.prototype.sendVerifyMessage=function(){return mainService.ajax({url:"Auth/SendMessage",data:{send_type:0}})},o.prototype.verifyMessage=function(e){return mainService.ajax({url:"Auth/VerifyMessage",data:e,error:function(e,t,o){return 10016==e?!1:void 0}})},o.prototype.updateOrderAddress=function(e){return e.source=t.config.isMobileTerminal?21:11,mainService.ajax({url:"Order/UpdateAddress",data:e})},o.prototype.updateOrderInvoice=function(e){return e.source=t.config.isMobileTerminal?21:11,e.id&&delete e.id,mainService.ajax({url:"Order/UpdateInvoice",data:e})},o.prototype.cancelOrder=function(e){return mainService.ajax({url:"Order/Cancel",data:{order_id:e},error:function(e,t,o){return 10016==e?!1:void 0}})},o.prototype.downInvoice=function(e,o,i){switch(o){case"support":window.open(t.config.baseUrl+"acceptOrderInvoice&ao_id="+e);break;default:window.open(t.config.baseUrl+"Invoice/Download&order_id="+i+"&invoice="+e)}},o.prototype.removeCache=function(t){var o=e.cookies.filter("^eo");e.each(o,function(t,o){e.cookies.del(t)}),"function"==typeof t&&t()},new o}(jQuery,window.Store)),window.Store.addModel("Checkout",function(){return Backbone.Model.extend({defaults:{}})}),window.Store.addView("CheckoutAddress",function(){return Backbone.View.extend({events:{"click .js-choose-address":"chooseAddress","click .js-more-address":"moreAddress","click .js-add-address":"addAddress","click .js-edit-address":"editAddress","click .js-delete-address":"deleteAddress"},initialize:function(e){var t=this;t.addressService=Store.getService("Address"),t.promiseView=ct.get("checkout-address"),t.isSupport=e.isSupport,t.isNuts=e.isNuts,t.isOpen=e.isOpen,t.uiPlugin=Store.getPlugin("UI"),t.dialogPlugin=Store.getPlugin("Dialog"),t.singleAddressData={},t.isMobileNewAddress=!1,t.addressFormModel=new(Store.getModel("AddressForm")),t.chooseAddressIndex=0,t.isShowWarning=t.isSupport,t.isUseForm=!1,t.curAddress=$.extend({},e.curAddress),t.listenTo(t.collection,"add",t.addAddressItem),t.listenTo(t.collection,"change",t.updateAddressItem),t.listenTo(t.collection,"remove",t.removeAddressItem)},render:function(){var e=this;return e.promiseView.done(function(t){e.$el.html(ct.compile(t,{addresses:{curAddress:e.curAddress,list:e.collection.toJSON()},isSupport:e.isSupport,isNuts:e.isNuts,isOpen:e.isOpen}));{var o=e.$el;o.find(".js-checkout-address-panel"),e.collection.length}e.renderAddressList()}),this},renderAddressForm:function(e){var t=this,o=t.$el.find(".js-checkout-address-panel"),i=t.$(".js-single-address-panel");t.isUseForm=!0,e?(o.height(210),o.children().hide(),o.animate({height:370},{duration:500,easing:"easeOutQuart",complete:function(){i.fadeIn(300)}})):(o.children().hide(),i.show()),i.data("inited")||i.data("inited",!0)},renderAddressList:function(){var e=this,t=this.$el,o=t.find(".js-checkout-address-panel"),i=e.$(".js-multiple-address-panel"),r=e.$(".js-choose-address"),a=e.$(".js-add-address");if(r.length<10?r.eq(2).after(a):r.eq(3).toggleClass("fn-hide",!1),e.isUseForm=!1,o.children().hide(),i.show(),!i.data("inited")){i.data("inited",!0);var n=e.collection.where({"default":1},!0);n=n?n.get("id"):e.collection.first()?e.collection.first().get("id"):void 0,e.uiPlugin.radio({wrapper:i,name:"address_id",callback:function(t){t.closest(".js-choose-address").toggleClass("selected-address-item",!0).siblings(".js-choose-address").toggleClass("selected-address-item",!1);var o=e.collection.get(t.data("id")).toJSON();e.curAddress=$.extend({},o),Store.config.isMobile&&e.mShowCurPanel("cur")},checked:n})}},chooseAddress:function(e){$(e.currentTarget).find(":radio").prop("checked",!0).change()},moreAddress:function(e){var t=this,o=$(e.currentTarget),i=t.$(".js-add-address");t.$(".js-address-item-list").append(i),o.remove(),t.$(".js-choose-address").toggleClass("fn-hide",!1)},addAddress:function(e){e.stopPropagation();var t=new(Store.getView("AddressDialog"))({model:new(Store.getModel("AddressForm"))});t.render("add")},editAddress:function(e){e.stopPropagation();var t=this,o=$(e.target).closest(".js-choose-address"),i=new(Store.getView("AddressDialog"))({model:t.collection.get(o.data())});i.render("save")},deleteAddress:function(e){e.stopPropagation();var t=this,o=$(e.target).data("id");t.dialogPlugin.confirm({message:"确认删除地址？",done:function(e){t.addressService.removeAddress(o),e.close()}})},addAddressItem:function(e){var t=this,o=t.$(".js-add-address"),i=t.$(".js-choose-address"),r=$(ct.compile(ct.get("tempCheckoutAddressListItem",!0),{address:e.toJSON()}));i.length<9?t.$(".js-more-address").length?i.eq(1).after(o):t.$(".js-address-item-list").append(o):o.remove(),t.$(".js-address-item-list").prepend(r),r.find("input").prop("checked",!0).change()},updateAddressItem:function(e){var t=this,o=t.$el.find(".js-checkout-address-panel"),i=o.find("[value="+e.id+"]"),r=i.closest(".js-choose-address"),a=i.prop("checked"),n=ct.compile(ct.get("tempCheckoutAddressListItem",!0),{address:e.toJSON()},!0);r.after(n),r.remove(),a&&n.find("input").prop("checked",a).change()},removeAddressItem:function(e){var t=this,o=t.$(".js-choose-address[data-id="+e.id+"]"),i=t.$(".js-add-address"),r=t.$(".js-choose-address");1==r.length&&(t.curAddress={}),i.length||(i=ct.compile(ct.get("tempCheckoutInsertAddress",!0),{},!0)),o.fadeOut(300,function(){o.hasClass("selected-address-item")&&r.eq(0==o.index()?1:0).find("input").prop("checked",!0).change(),t.$(".js-more-address").length?r.eq(3).toggleClass("fn-hide",!1).after(i):t.$(".js-address-item-list").append(i),$(this).remove(),4==r.length&&t.$(".js-more-address").click()})},getAddressData:function(){var e=this,t=e.curAddress;return $.extend({},t)}})}),window.Store.addView("Checkout",function(){return Backbone.View.extend({el:".content",events:{"keydown .js-discount-text":"discountInput","keyup .js-discount-text":"discountChange","blur .js-discount-text":"discountBlur","click .js-choose-coupon":"checkRadio"},initialize:function(e){var t=this;t.curView=null,t.isBuy=e.isBuy,t.isNuts=e.isNuts,t.isOpen=e.isOpen,t.pvDetail={},t.uiPlugin=Store.getPlugin("UI"),t.dialogPlugin=Store.getPlugin("Dialog"),t.verifyPlugin=Store.getPlugin("Verify"),t.UtilService=Store.getService("Util"),t.OrderService=Store.getService("Order"),t.MobileService=Store.getService("Mobile"),t.dialogOrderConfirm=new(Store.getView("OrderConfirmDialog")),t.total=0},render:function(e,t){var o=this,i=(Store.getModel("Address"),new(Store.getView("CheckoutAddress"))({el:o.$(".js-checkout-address-box"),collection:o.collection,curAddress:t.addresses.curAddress,isNuts:o.isNuts,isOpen:o.isOpen}));o.total=t.carts.total,o.canUseCashCard=t.carts.orderTotal,o.chooseCoupon={},o.curView=e,o.carts=t.carts,o.realAmount=o.carts.orderTotal,o.radioCoupon=o.uiPlugin.radio({wrapper:o.$(".js-coupon-list"),name:"coupon",notDefault:!0,callback:function(e,t){var i=e.closest("li");o.$(".js-coupon-list").children("li").toggleClass("on",!1),i.toggleClass("on",!0),2==i.data("type")?o.sumTotal(i.data("amount"),2):o.sumTotal(i.find(".js-discount-text").val(),1)}}),o.LoadingButton=!1,o.verifyPlugin.bindVerify({wrapper:o.$el,verifyDom:".js-verify",button:o.$(".js-checkout"),error:function(e){e.focus()},success:function(e){
if(!Store.config.isMobile||!o.LoadingButton){o.LoadingButton=!0;var r={},a=i.getAddressData();if(!a.id)return $(window).scrollTop(0),o.dialogPlugin.message({message:"请选择一个送货地址",done:function(e){e.close()}}),!1;r.address_id=a.id,delete a.id,r=$.extend(r,a),r.pay_channel_type=Store.config.isMobile?"8":"1",r.invoice_style=2,r.invoice_type=0,o.chooseCoupon.discount&&(r.discount=o.chooseCoupon.code+":"+o.chooseCoupon.discount);var n={id:t.curOrder.id,cdkey_code:t.curOrder.cdkey_code,discount_amount:t.curOrder.discount_amount,pay_type:t.curOrder.pay_type,goods_infos:t.curOrder.goods_infos},s=$.extend({},r,n);$.each(s,function(e,t){void 0==s[e]&&delete s[e]}),t.curOrder.isMobileOrder?o.createMobileOrder(s):o.createStoreOrder(s)}}}),i.render()},checkRadio:function(e){var t=$(e.currentTarget),o=$(e.target);o.closest(".blue-radio").length||t.find("input").prop("checked",!0).change()},sumTotal:function(e,t){var o=this,e=0|e;o.$(".js-discount-cash").toggleClass("discount-line-show",!!e),o.$(".js-discount-cash em").text(2==t?"优惠券":"现金券"),o.$(".js-discount-cash span").text(Store.filter.rmb(e,!0)),o.realAmount=o.carts.orderTotal-e,o.$(".last-payment .prices em").text(Store.filter.rmb(o.realAmount,!0)),o.$(".js-total").text(Store.filter.rmb(o.realAmount,!0)),o.chooseCoupon={code:o.radioCoupon.choosed().id,discount:e}},discountChange:function(e){var t=this,o=e.keyCode,i=$(e.currentTarget).val();return!e.shiftKey&&(o>47&&58>o||o>94&&106>o||8==o||13==o||37==o||39==o)?(/^\d+$/.test(i)&&i<=t.carts.orderTotal&&t.sumTotal(i),void(13==o&&$(e.currentTarget).blur())):(Store.config.isFirefox&&$(e.currentTarget).val(i.replace(/[^\d]/,"")),!1)},discountInput:function(){{var e=event.keyCode;$(event.currentTarget).val()}return!event.shiftKey&&(e>47&&58>e||e>94&&106>e||8==e||13==e||37==e||39==e)?void 0:!1},discountBlur:function(e){var t=this,o=$(e.currentTarget),i=0|o.val(),r=0|o.data("max");(!/^\d+$/.test(i)||i>r)&&(i=r),0>=i&&(i=0),o.val(i),t.sumTotal(i)},createStoreOrder:function(e){var t=this;t.dialogOrderConfirm.render(e,function(o){t.OrderService.createOrder(e).done(function(i){t.createStoreComplete(i,e,o)}).fail(function(e,o,i){t.createStoreFail(e,o,i)})})},createMobileOrder:function(e){var t=this;t.dialogOrderConfirm.render(e,function(o){t.MobileService.createOrder(e).done(function(i){t.createStoreComplete(i,e,o)}).fail(function(e,o,i){t.createStoreFail(e,o,i)})})},createStoreComplete:function(e,t,o){var i=this;o&&o.close();var r=i.carts,a=+new Date,n=Store.filter.date(a,"YYYY-MM-DD hh:mm:ss"),s=0;$.each(r.list,function(e,t){s+=0|t.num}),n=s+"_"+n,i.UtilService.SMpvOrder(r.total+r.postage,e.order_id,n);var c="order/payment/"+e.order_id;i.isBuy?window.location.href=Store.config.storeUrl+c:Store.Router.navigate(c,{trigger:!0})},createStoreFail:function(e,t,o,i){var r=this;if(i&&i.loadingBtn.reset(),r.LoadingButton=!1,Store.config.isMobile&&(r.LoadingButton=!1),11004==e)try{var a=new(Store.getView("BuzyDialog"));a.render()}catch(n){r.dialogPlugin.message({message:"十分抱歉，由于购买人数较多，服务器拥堵，请您稍后重试。"})}}})}),window.Store.addView("Confirm",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.PaymentService=Store.getService("Payment"),e.DialogPlugin=Store.getPlugin("Dialog"),e.PaymentDialog=new(Store.getView("PaymentDialog"))},events:{"click .js-payment-order":"paymentOrder"},render:function(e){var t=this;t.viewData=e,Store.config.isMobile||$(window).on("scroll",function(){var e=$(this).scrollTop(),t=$(".order-confirm-fixbar");e>695?t.is(":hidden")&&(Store.config.opacity?(t.css({opacity:"0"}).show(),t.animate({opacity:"1"},{queue:!1,duration:200})):t.show()):t.is(":visible")&&(Store.config.opacity?t.css({opacity:"0"}).hide():t.hide())})},paymentOrder:function(e){var t=this,o=t.viewData.tempData.order;Store.config.isMobile||t.PaymentService.doPayment(o),t.PaymentService.paymentStatus(o).done(function(e){if(1==e.status){if(Store.config.isMobile)return void Store.Router.navigate("order/payment/"+o.order_id,{trigger:!0});o.orderRealTotal=e.amount,t.PaymentDialog.render("result",o)}else{if(Store.config.isMobile){var i=Store.config.isWeixin?"?showwxpaytitle=1":"";return void Store.Router.navigate("account/orderdetail"+o.order_id+i,{trigger:!0})}t.DialogPlugin.confirm({message:"订单已支付，或已失效。",doneText:"查看订单",done:function(e){e.close(),Store.Router.navigate("account/order",{trigger:!0})}})}})}})}),window.Store.addView("Payment",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.pvDetail=null,e.UtilService=Store.getService("Util"),e.PaymentService=Store.getService("Payment"),e.uiPlugin=Store.getPlugin("UI"),e.DialogPlugin=Store.getPlugin("Dialog"),e.PaymentDialog=new(Store.getView("PaymentDialog")),e.$paymentCodePanel=e.$(".js-payment-code-panel"),e.$paymentButton=e.$(".js-payment-order")},events:{"click .tag-list li":"checkRadio","click .payment-list li":"checkRadio","click .installment-list li":"checkRadio","click .js-payment-order":"paymentOrder"},render:function(e,t){var o=this;o.tempData=t,o.uiPlugin.chooseTags({$wrapper:o.$(".js-choose-payment-panel")}),o.uiPlugin.radio({wrapper:o.$(".js-choose-payment-panel"),name:"payMenuType",checked:"online",callback:function(e,t){{var i=e.closest(".tag-item").click().index(),r=t.wrapper.find(".con-item").eq(i);r.siblings(".con-item")}"online"==e.val()?o.$paymentButton.toggleClass("fn-hide",!0):(o.$paymentButton.toggleClass("fn-hide",!1),r.find("input:first").prop("checked",!0).change())}}),o.paymentItemRadio=o.uiPlugin.radio({wrapper:o.$(".js-choose-payment-panel"),name:"pay_channel_type",notDefault:!0,callback:function(e,i){if(i.wrapper.find(".selected").removeClass("selected"),e.closest("li").addClass("selected"),o.$paymentCodePanel.toggleClass("fn-hide",!0),o.$paymentButton.toggleClass("fn-hide",!1),t.order.pay_channel_type=e.val(),9==e.data("id")){o.$paymentButton.toggleClass("fn-hide",!0);var r=o.$paymentCodePanel.find("img");o.$paymentCodePanel.toggleClass("fn-hide",!1),""==r.attr("src")&&r.attr("src",o.PaymentService.weixinPaymentCode(t.order)),o.loopWeixin(t.order)}}})},loopWeixin:function(e){var t=this,o=Store.loop.weixin=setInterval(function(){t.PaymentService.loopWeixin(e).done(function(i){1==i.res&&t.PaymentDialog.render("complete",e),(1==i.res||9!=t.paymentItemRadio.choosed().id)&&clearInterval(o)})},1e3)},proxyToggleGoods:function(){this.$(".js-toggle-goods").trigger("click")},toggleGoods:function(e){var t=this,o=$(e.currentTarget);o.toggleClass("common-line-down-arrow-icon",!1),t.$(".js-goods-panel").toggleClass("single-goods-panel",!1)},paymentOrder:function(e){var t=this,o=t.tempData.order;return Store.config.isMobile&&(o.pay_channel_type=8),!o.isSupport&&Store.config.isWeixin&&Store.config.useWeixinCheck?(window.location.href="/payment/?order_id="+o.order_id+"&pay_type="+t.PaymentService.getPayType(o)+"&showwxpaytitle=1",!1):(t.PaymentService.doPayment(o),void(Store.config.isMobile||t.PaymentService.paymentStatus(o,o.isSupport).done(function(e){o.orderRealTotal=e.amount,1==e.status?(o.orderRealTotal=e.amount,t.PaymentDialog.render("result",o)):t.DialogPlugin.confirm({message:(o.isSupport?"维修费":"订单")+"已支付，或已失效。",doneText:"查看"+(o.isSupport?"服务单":"订单"),done:function(e){e.close();var t=o.isSupport?"/account/#/support/detail/"+o.ao_id:"/account/#/order/detail/"+o.order_id;window.location.href=t}})})))},checkRadio:function(e){var t=$(e.currentTarget),o=$(e.target);o.closest(".blue-radio").length||t.find("input").prop("checked",!0).change()}})}),window.Store.addView("AccountSidebar",function(){return Backbone.View.extend({el:".content",template:"",events:{"click .js-get-giftcard":"getGiftcard"},initialize:function(){var e=this;e.UserService=Store.getService("User"),e.DialogPlugin=Store.getPlugin("Dialog"),e.userinfo=null,e.listenTo(e.model,"change",e.updateInfo)},render:function(e,t){var o=this,i={},r=o.$(".account-sidebar");return e.coupon.code&&Store.config.useExportGiftcard&&(e.limt_num=Math.floor(e.coupon.real_amount/100)),o.userinfo=e,i.isUserinfo="userinfo"==t,i.isOrder="order"==t||"orderdetail"==t,i.isPreorder="preorder"==t,i.isSupport="support"==t||"supportdetail"==t,i.isAddress="address"==t,""!=o.userinfo.nickname&&o.$(".account-wrapper").toggleClass("account-min-wrapper",!0),ct.get("account-sidebar").then(function(t){r.html(ct.compile(t,{userinfo:e,channel:i}))}),o},updateInfo:function(e,t){var o=this,i=ct.get("tempupdateSidbarAccountInfo",!0);o.$(".js-account-sidebar-info").html(ct.compile(i,{userinfo:e.toJSON()}))},bindAction:function(){var e=this,t=e.$(".account-sidebar"),o=e.$(".account-wrapper"),i=o.offset().top;$(window).on("scroll",function(){var e=$(this).scrollTop(),r=$(window).height(),a=o.height()-t.height(),n=0;r>t.height()&&a>0&&e>i-20&&(n=e-i+20,n=Math.min(n,a)),t.css("top",n)})},chooseType:function(e){var t=this,o=t.$(".account-nav"),e="orderdetail"==e?"order":e;o.find('[data-type="'+e+'"]').toggleClass("current",!0).siblings().toggleClass("current",!1)},resetSidebar:function(){var e=this,t=e.$(".account-sidebar");t.css("top",0)}})}),window.Store.addView("AccountInfo",function(){return Backbone.View.extend({initialize:function(){var e=this;e.dialogIframeKeepView=!0,e.isSendEmail=!1,e.info={},e.UserService=Store.getService("User"),e.listenTo(e.model,"change",e.updateInfo)},el:".account-content",events:{"click .js-send-email":"sendEmail","click .js-modify-avatar":"modifyAvatar"},render:function(e,t){var o=this;o.info=t.user},updateInfo:function(e,t){var o=this,i=ct.get("tempupdateAccountInfo",!0);o.info=e.toJSON(),o.$(".js-account-info").html(ct.compile(i,{user:e.toJSON()}))},sendEmail:function(e){var t=this,o=$(e.currentTarget);t.isSendEmail?window.open(Store.filter.emailLocation(t.info.email)):(t.isSendEmail=!0,o.text("查看邮件"),t.UserService.sendEmail())},modifyAvatar:function(){var e=this;Store.currentView.loginProxy=null,e.UserService.login(function(){e.UserService.openModifyAvatar()})}})}),window.Store.addModel("Order",function(){return Backbone.Model.extend({defaults:{},initialize:function(){}})}),window.Store.addCollection("Order",function(){return Backbone.Collection.extend({model:Store.getModel("Order")})},!0),window.Store.addService("Support",function(e,t){function o(){var e=this;e.OrderParseService=null,e.SupportCollection=null}return o.prototype.init=function(){var e=this;e.OrderParseService=t.getService("OrderParse")},o.prototype.getDetail=function(e){var o=this;return mainService.ajax({url:"AcceptOrder/Detail",data:{ao_id:e},success:function(e){return t.isArray(e)&&!e.length||!e?!1:e=o.OrderParseService.parseSupport(e)}})},o.prototype.getDetailByOrder=function(e,t){var o=this;return mainService.ajax({url:"acceptOrder/OrderDetail",data:{order_id:e,goods_id:t},success:function(e){return e=o.OrderParseService.parseSupportConfirm(e),e.byOrder=!0,e}})},o.prototype.getDetailByImei=function(e){return mainService.ajax({url:"acceptOrder/orderdetailbyimei",data:e,error:function(e){return 10004!=e&&1e3!=e?!1:void 0}})},o.prototype.createOrderByOrder=function(e){{var t=this;e.tempID}return delete e.tempID,mainService.ajax({url:"acceptOrder/create",data:e,success:function(e){return t.removeCache(),e}})},o.prototype.createOrderByImei=function(e){{var t=this;e.tempID}return delete e.tempID,mainService.ajax({url:"acceptOrder/createByImei",data:e,success:function(e){return t.removeCache(),e}})},o.prototype.getSupportList=function(e){var o=this;return e.page_size=10,"all"==e.type&&delete e.type,"quarter"==e.time&&delete e.time,mainService.ajax({url:"acceptOrder/list",data:e,success:function(e){return e.list=o.OrderParseService.parseSupportList(e.list),o.SupportCollection=t.getCollection("Support",e.list),e}})},o.prototype.cancelSupport=function(e){return mainService.ajax({url:"acceptOrder/cancel",data:{ao_id:e}})},o.prototype.updateSupportInvoice=function(e){return e.id&&delete e.id,mainService.ajax({url:"acceptOrder/UpdateInvoice",data:e})},o.prototype.applyPostage=function(e){return mainService.ajax({url:"acceptOrder/ReplyPostage",data:e})},o.prototype.verifyImeiForWarranty=function(e){return mainService.ajax({url:"Order/CheckInsuranceOnPhoneOffline",data:e,error:function(e){return 10004!=e?!1:void 0}})},o.prototype.removeCache=function(){var t=e.cookies.filter("^so");e.each(t,function(t,o){e.cookies.del(t)})},new o}(jQuery,window.Store)),window.Store.addView("WarrantyBuying",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.VerifyPlugin=Store.getPlugin("Verify"),e.DialogPlugin=Store.getPlugin("Dialog"),e.FileUploadPlugin=Store.getView("FileUpload"),e.UserService=Store.getService("User"),e.SupportService=Store.getService("Support"),e.MobileService=Store.getService("Mobile"),e.MobileGoodsService=Store.getService("MobileGoods"),e.UtilService=Store.getService("Util"),e.$imeiPanel=e.$(".js-imei-panel"),e.$file=e.$(".js-upload-file").prop("disabled",!0),e.$verifyImeiButton=e.$(".js-verify-imei"),e.$uploadButton=e.$(".js-do-upload"),e.$mainButton=e.$(".js-create-order"),e.$chooseWarrantyWrapper=e.$(".js-choose-warranty-wrapper"),e.processStatus=e.modelStatus(),e.chooseWarrantyView=new(Store.getView("ChooseWarranty"))({el:e.$chooseWarrantyWrapper,callback:function(){e.processStatus.setChoose(!!e.chooseWarrantyView.selectItem().choosed.length)}}),e.postData={}},events:{"click .js-route-buy":"routeBuy","keypress .js-imei-panel .js-verify":"inputImei","click .js-do-upload":"openUpload","click .js-create-order":"createOrder"},render:function(e){var t=this;t.uiPlugin.captcha({wrapper:t.$imeiPanel}),t.resetWarrantyView({visibleWarranty:!1,accident:{},delay:{}}),t.verifyImeiModule=t.VerifyPlugin.bindVerify({wrapper:t.$imeiPanel,verifyDom:".js-verify",button:t.$verifyImeiButton,success:function(e,o){return t.$verifyImeiButton.hasClass("disabled-btn")?!1:void t.SupportService.verifyImeiForWarranty(o).done(function(e){t.$verifyImeiButton.toggleClass("disabled-btn",!0),t.$(".js-imei-tips").remove(),t.$imeiPanel.find(".module-form-item-wrapper").toggleClass("disabled-item",!0).find("input").prop("disabled",!0);var i=t.MobileGoodsService.mapPhones[e.imei_goods_code];t.resetWarrantyView({visibleWarranty:!0,mobileData:i,nowTime:e.current_time,accident:e.accident,delay:e.delay}),t.postData.imei=o.imei,t.processStatus.setImei(!0),$("html,body").animate({scrollTop:t.$(".js-safety-offset").offset().top})}).fail(function(o,i,r){t.processStatus.setImei(!1),10014==o&&(e.thrown(t.$imeiPanel.find('[name="captcha_code"]'),"不正确",!0),t.$imeiPanel.find('[name="captcha_code"]').val("").focus(),t.$imeiPanel.find(".verifycon").click()),30024==o&&e.thrown(t.$imeiPanel.find('[name="imei"]'),"无效",!0)})}})},routeBuy:function(){},modelStatus:function(){var e=this,t=!1,o=!1,i=!1,r={setImei:function(o){t=0|o,e.updateMainButton()},setUpload:function(t){o=0|t,e.updateMainButton()},setChoose:function(t){i=0|t,e.updateMainButton()},getImei:function(){return!!t},getUpload:function(){return!!o},getChoose:function(){return!!i},getCombFlag:function(){return t&&i}};return r},inputImei:function(){this.processStatus.setImei(!1)},resetWarrantyView:function(e){this.chooseWarrantyView.render(e)},updateMainButton:function(){var e=this,t=!1;t=e.processStatus.getCombFlag(),e.$mainButton.toggleClass("disabled-btn",!t)},createOrder:function(e){var t=this;if(!$(e.currentTarget).hasClass("disabled-btn")){var o=t.chooseWarrantyView.selectItem();if(Store.config.useNewWarranty){var i={pay_type:2,singleService:!0,imei:t.postData.imei,invoice_style:2,invoice_type:0},r=[],a=0;$.each(o.warrantys,function(e,t){r.push(t.sku+":1"),a+=t.price}),i.goods_infos=r.join(","),t.MobileService.createOrder(i).done(function(e){var t="order/payment/"+e.order_id;Store.Router.navigate(t,{trigger:!0})})}else{var i={pay_type:2,singleService:!0,imei:t.postData.imei};$.each(o.warrantys,function(e,t){i[t.postName]=t.sku}),t.MobileService.completeTempOrder(i).done(function(e){Store.Router.navigate("checkout/"+e.id,{trigger:!0})})}}}})}),window.Store.addView("MobileCdkey",function(){return Backbone.View.extend({el:".content",events:{"click .js-return-verify":"returnVerify","click .js-use-code":"useCode"},initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.VerifyPlugin=Store.getPlugin("Verify"),e.DialogPlugin=Store.getPlugin("Dialog"),e.MobileService=Store.getService("Mobile"),e.MobileGoodsService=Store.getService("MobileGoods"),e.UserService=Store.getService("User"),e.UtilService=Store.getService("Util"),e.postData=null},render:function(){var e=this;return e.postData={},e.testPanel=e.$(".js-test-mobile-code-wrapper"),e.invalidPanel=e.$(".js-invalid-mobile-code-wrapper"),e.usePanel=e.$(".js-use-mobile-code-wrapper"),e.verFn=e.VerifyPlugin.bindVerify({wrapper:e.testPanel,verifyDom:".js-verify",button:e.$(".js-verify-code-btn"),success:function(t,o){e.verifyCode(t,o)}}),e.uiPlugin.captcha({wrapper:e.testPanel}),this},verifyCode:function(e,t){var o=this;o.MobileService.verifyMobileCdkey(t).done(function(e){var i=o.MobileGoodsService.mapPhones[e.pre_goods_id];o.postData={mobile_id:e.pre_goods_id,mobileData:i,cdkey_code:t.cdkey_code,name:i.name,codeImage:i.codeImage,discount_amount:e.money,isDisabled:1==e.status},o.usePanel.html(ct.compile(ct.get("tempMobileCodeUse",!0),{phone:o.postData})),o.testPanel.hide(),o.usePanel.fadeIn()}).fail(function(t,i,r){if(10014==t)e.thrown(o.$('[name="captcha_code"]'),"不正确",!0),o.$('[name="captcha_code"]').val("").focus(),o.$(".verifycon").click();else{var a="";switch(t){case 21003:a="该优先购买码已过期";break;case 21008:a="该优先购买码被使用";break;case 21009:a="该产品尚未发布";break;default:a="该优先购买码无效"}o.invalidPanel.html(ct.compile(ct.get("tempMobileCodeInvalid",!0),{errorMsg:a})),o.testPanel.hide(),o.invalidPanel.fadeIn()}})},returnVerify:function(){var e=this;e.verFn.reset(e.testPanel),e.$(".verifycon").click(),e.invalidPanel.hide(),e.testPanel.fadeIn()},useCode:function(e){var t=this;return t.postData.isDisabled?!1:void t.MobileService.createTempOrder(t.postData).done(function(e){var o=t.MobileGoodsService.mapPhones[t.postData.mobile_id];if(o){var i;"t2"==o.category&&(i="T2"),"nuts"==o.category&&(i="坚果"),i&&t.UtilService.SMpvEvent(i,"现在购买")}Store.Router.navigate("accessories/"+e.id,{trigger:!0})})}})}),window.Store.addView("CdkeyDelay",function(){return Backbone.View.extend({el:".content",events:{"click .js-return-verify":"returnVerify"},initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.VerifyPlugin=Store.getPlugin("Verify"),e.DialogPlugin=Store.getPlugin("Dialog"),e.MobileService=Store.getService("Mobile"),e.MobileGoodsService=Store.getService("MobileGoods"),e.UserService=Store.getService("User"),e.UtilService=Store.getService("Util"),e.postData=null},render:function(){var e=this;return e.postData={},e.testPanel=e.$(".js-test-mobile-code-wrapper"),e.invalidPanel=e.$(".js-invalid-mobile-code-wrapper"),e.usePanel=e.$(".js-use-mobile-code-wrapper"),e.verFn=e.VerifyPlugin.bindVerify({wrapper:e.testPanel,verifyDom:".js-verify",button:e.$(".js-verify-code-btn"),success:function(t,o){e.verifyCode(t,o)}}),e.uiPlugin.captcha({wrapper:e.testPanel}),this},verifyCode:function(e,t){var o=this;o.MobileService.verifyCdkeyDelay(t).done(function(e){o.usePanel.html(ct.compile(ct.get("tempMobileCdkeyDelayCodeUsed",!0),{})),o.testPanel.hide(),o.usePanel.fadeIn()}).fail(function(t,i,r){10014==t?(e.thrown(o.$('[name="captcha_code"]'),"不正确",!0),o.$('[name="captcha_code"]').val("").focus(),o.$(".verifycon").click()):(o.invalidPanel.html(ct.compile(ct.get("tempMobileCdkeyDelayCodeInvalid",!0),{errorMsg:i})),o.testPanel.hide(),o.invalidPanel.fadeIn())})},returnVerify:function(){var e=this;e.verFn.reset(e.testPanel),e.$(".verifycon").click(),e.invalidPanel.hide(),e.testPanel.fadeIn()}})}),window.Store.addView("AccountAddress",function(){return Backbone.View.extend({el:".account-content",events:{"click .js-add-address":"addAddress","click .js-edit-address":"editAddress","click .js-del-address":"deleteAddress","click .js-set-default":"setDefault"},initialize:function(){var e=this;e.dialogPlugin=Store.getPlugin("Dialog"),e.addressService=Store.getService("Address"),e.listenTo(e.collection,"change",e.updateAddressItem),e.listenTo(e.collection,"add",e.addAddressItem),e.listenTo(e.collection,"remove",e.removeAddressItem)},render:function(e){{var t=this;t.$el}t.view=e,t.renderAdressView()},renderAdressView:function(){var e=this,t=this.$el;if(e.collection.length)t.find(".box-inner").html(ct.compile(ct.get("tempAccountAddressList",!0),e.view.tempData));else{var o=new(Store.getView("AddressForm"))({el:t.find(".box-inner"),useBtn:!0,useVerify:!0,button:$(".button"),done:function(t,o){e.addressService.addAddress(t)}});o.render()}},editAddress:function(e){e.stopPropagation();var t=this,o=$(e.target).closest(".address-list-item"),i=o.data("id"),r=new(Store.getView("AddressDialog"))({model:t.collection.get({id:i})});r.render("save")},updateAddressItem:function(e){var t=this,o=t.$(".address-list-item[data-id="+e.id+"]"),i=$(ct.compile(ct.get("tempAccountAddressItem",!0),{address:e.toJSON()}));o.after(i),o.remove()},addAddress:function(){var e=this;if(e.collection.length>=10)return void e.dialogPlugin.message({message:"最多只能有 10 个收货地址"});var t=new(Store.getView("AddressDialog"))({model:new(Store.getModel("AddressForm"))});t.render("add")},addAddressItem:function(e,t){var o=this.$el,i=$(ct.compile(ct.get("tempAccountAddressItem",!0),{address:e.toJSON()}));t.length>1?1!=e.get("default")&&t.where({"default":1},!0)?o.find(".address-list-item:first").after(i):o.find(".address-list-item:first").before(i):o.find(".box-inner").html(i)},deleteAddress:function(e){var t=this,o=$(e.currentTarget),i=o.closest(".address-list-item");o.hasClass("delete-btn-on")?t.addressService.removeAddress(i.data("id")):(o.addClass("delete-btn-on"),o.find("a").hide(),o.animate({width:"61px"},{duration:200,easing:"easeOutQuart"}),o.find("em").show().css({width:"61px",opacity:"0"}).animate({opacity:"1"},{duration:200,easing:"easeOutQuart",complete:function(){$(document).one("click",function(e){$(e.target).closest(".delete-btn-on").length||(o.removeClass("delete-btn-on"),o.find("a").show(),o.animate({width:"26px"},{duration:200,easing:"easeOutQuart"}),o.find("em").css({width:"26px"}).animate({opacity:"0"},{duration:200,easing:"easeOutQuart"}))})}}))},removeAddressItem:function(e){var t=this;t.$(".address-list-item[data-id="+e.id+"]").slideUp(300,function(){$(this).remove(),t.collection.length||t.renderAdressView()})},setDefault:function(e){var t=this,o=$(e.currentTarget),i=o.closest(".address-list-item");t.addressService.setDefault(i.data("id"))}})}),window.Store.addView("PaymentResult",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.UtilService=Store.getService("Util")},events:{"click .js-link-order":"linkOrder","click .js-share":"pvShare"},render:function(e,t){var o=this;if(o.isAbort=!1,o.tempData=t,Store.config.isMobile||t.order.isMobileOrder||o.doCountdown(),t.status.success&&!t.type.isSupport){var i=t.order,r=+new Date,a=Store.filter.date(r,"YYYY-MM-DD hh:mm:ss"),n=0;i&&i.carts&&$.each(i.carts,function(e,t){n+=0|t.num}),a=n+"_"+a,o.UtilService.SMpvPayment(i.order_amount,i.order_id||555,a)}},linkOrder:function(){var e=this;e.isAbort=!0,window.location.href=e.tempData.type.isSupport?"/account/#/support/list":"/account/#/order/list"},doCountdown:function(){var e=this;Store.filter.countdown({time:10,$label:e.$(".js-down-count"),callback:function(){e.isAbort=!0,e.linkOrder()},abort:function(){return e.isAbort||"payment-result"!=Store.currentView.url?!1:!0}})},pvShare:function(){}})}),window.Store.addView("TmallExchange",function(){return Backbone.View.extend({el:".content",initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.VerifyPlugin=Store.getPlugin("Verify"),e.OrderService=Store.getService("Order"),e.$mainButton=e.$(".js-exchange-order"),e.$code=e.$("[name=code]"),e.$verify=e.$("[name=verify]"),e.codeVerifyed=!1},events:{},render:function(e){var t=this;t.uiPlugin.captcha({wrapper:t.$el}),t.VerifyPlugin.bindVerify({wrapper:t.$el,verifyDom:".js-verify",button:t.$mainButton,success:function(e,o){console.log(o),t.OrderService.verifyMobileCode(o).done(function(e){t.codeVerifyed=!0}).fail(function(e,o,i){1017==e&&(t.VerifyPlugin.thrown(t.$verify,"不正确",!0),t.$verify.val("").focus(),t.$(".verifycon").click()),1006==e&&(t.VerifyPlugin.thrown(t.$code,"兑换码无效",!0),t.$code.focus())})},error:function(e,t){e.focus()}})},verifyCode:function(){var e=this,t=$.trim(e.$code.val()),o=$.trim(e.$verify.val());if(e.codeVerifyed||!t||!o)return!1;var i={cdkey_code:t,captcha_code:o};e.OrderService.verifyMobileCode(i).done(function(t){e.codeVerifyed=!0}).fail(function(t,o,i){1017==t&&(e.VerifyPlugin.thrown(e.$verify,"不正确",!0),e.$verify.val("").focus(),e.$(".verifycon").click()),1006==t&&(e.VerifyPlugin.thrown(e.$code,"兑换码无效",!0),e.$code.focus())})},resetCode:function(){this.codeVerifyed=!1}})}),window.Store.addView("ThemeCover",function(){return Backbone.View.extend({el:".content",events:{"click .js-pv-button":"pvAction","click .js-weibo-pv":"pvWeiboAction"},initialize:function(){var e=this;e.ThemeService=Store.getService("Theme"),e.UtilService=Store.getService("Util")},render:function(e,t,o){var i=this;i.curPage=t,i.pageSize=o,i.maxPageCount=e.tempData.cover.page_count,$(window).scroll(function(){var e=$(window).height(),t=$(window).scrollTop(),o=$(document).height(),r=$(".footer").height();e+t+r>=o&&i.getDoodlesByPage()})},configPaging:function(e,t){var o=this;o.paging=o.PagingPlugin.render({$wrapper:o.$(".js-category-paging"),useLink:!0,href:"#/hd/qinghuai/?page=",data:{count:t.tempData.cover.count,page_count:o.maxPageCount,page:e}})},getDoodlesByPage:function(){var e=this;e.curPage<e.maxPageCount&&(e.curPage++,e.ThemeService.getDoodles({page:e.curPage,page_size:e.pageSize}).then(function(t){if(Store.isArray(t.list))for(var o=0;o<t.list.length;o++){t.list[o].isHide=!0;var i=ct.compile(ct.get("templateDoodlebox",!0),{item:t.list[o]},!0);e.$(".sku-box").append(i),i.fadeIn()}}))},pvAction:function(e){{var t=$(e.currentTarget);t.data("sku")}},pvWeiboAction:function(e){{var t=$(e.currentTarget);t.data("sku")}}})}),window.Store.addView("Recycle",function(){return Backbone.View.extend({el:".content",events:{"click .js-return-verify":"returnVerify","click .js-jump-exchange":"scrollExchange","click .js-recycle-login":"doLogin"},initialize:function(){var e=this;e.uiPlugin=Store.getPlugin("UI"),e.VerifyPlugin=Store.getPlugin("Verify"),e.DialogPlugin=Store.getPlugin("Dialog"),e.UserService=Store.getService("User"),e.UtilService=Store.getService("Util"),e.MobileService=Store.getService("Mobile"),e.AccountModel=Store.getModel("Account"),e.listenTo(e.AccountModel,"change",e.updateLoginForm),e.postData=null},render:function(e){var t=this;return t.postData={},t.testPanel=t.$(".js-test-mobile-code-wrapper"),t.invalidPanel=t.$(".js-invalid-mobile-code-wrapper"),t.usePanel=t.$(".js-use-mobile-code-wrapper"),t.updateLoginForm(),t.timeout=null,this},bindVerify:function(){var e=this;e.verFn=e.VerifyPlugin.bindVerify({wrapper:e.$el,verifyDom:".js-verify",button:e.$(".js-verify-code-btn"),success:function(t,o){e.verifyCode(t,o)}}),e.uiPlugin.captcha({wrapper:e.testPanel})},verifyCode:function(e,t){var o=this;o.MobileService.verifyCdkeyDelay(t).done(function(e){o.usePanel.html(ct.compile(ct.get("tempRecycleCodeUsed",!0),{})),o.testPanel.hide(),o.usePanel.fadeIn()}).fail(function(t,i,r){10014==t?(e.thrown(o.$('[name="captcha_code"]'),"不正确",!0),o.$('[name="captcha_code"]').val("").focus(),o.$(".verifycon").click()):(o.invalidPanel.html(ct.compile(ct.get("tempRecycleCodeInvalid",!0),{errorMsg:i})),o.testPanel.hide(),o.invalidPanel.fadeIn())})},returnVerify:function(){var e=this;e.verFn.reset(e.testPanel),e.$(".verifycon").click(),e.invalidPanel.hide(),e.testPanel.fadeIn()},scrollExchange:function(){var e=this;$("html, body").animate({scrollTop:e.$(".exchange-wrapper .intro-wrapper > h4").offset().top-90},1e3)},animateBounce:function(e){var t=this,o=t.$(".giftbag-phone");clearTimeout(t.timeout),o.addClass("animated bounce"),t.timeout=setTimeout(function(){o.removeClass("animated bounce")},1e3)},doLogin:function(){var e=this;e.UserService.login(function(){e.testPanel.html(ct.compile(ct.get("tempRecycleSubmitForm",!0),{})),e.bindVerify(),e.isLogin=1})},updateLoginForm:function(){var e=this;e.UserService.isLoggedIn?(e.testPanel.html(ct.compile(ct.get("tempRecycleSubmitForm",!0),{})),e.bindVerify(),e.isLogin=1):(e.testPanel.html(ct.compile(ct.get("tempRecycleSubmitLogin",!0),{})),e.isLogin=0)}})}),window.Store.onPageReady(function(){var e=Store.getService("Util"),t=Store.getService("LocalStorage"),o=Store.getService("User"),i=Store.getService("Cart"),r=Store.getService("Theme"),a=Store.getService("Address"),n=Store.getService("Order"),s=Store.getService("Support"),c=(Store.getService("Category"),Store.getService("OrderParse"),Store.getModel("Account"),Store.getService("Mobile")),l=Store.getService("MobileGoods"),u=Store.getService("Payment"),d=(ct.get("mobileMeta",!0),Store.getView("Layout"),Backbone.Router.extend({routes:{"":"home","login/:url":"login",login:"login","hd/:type(/?*querystring)":"theme",mobile:"mobile",easter:"easter",t1:"t1","t1/":"t1","t1/:params":"t1",jianguo:"jianguo","accessories/:id":"accessories","item/:itemId":"item","detail/:productId":"detail",cart:"cart","confirm/:id":"confirm",account:"accountLayout","warranty/agreement":"warrantyAgreementProxy","insurance/information":"warrantyInformation","insurance/buying":"warrantyBuying","cdkey/:param":"mobileCdkey",cdkey:"mobileCdkey","cdkey/":"mobileCdkey",delay:"delay",huanxin:"recycle","order/payment/:id":"orderPayment","payment/:type/:status":"paymentResult","payment/:type/:status/":"paymentResult","payment/:type/:status/:id":"paymentResult","error/:id":"error","*notFound":"notFound"},regRoutes:[{url:/^mobilecheckout\/(.*)/,medth:"mobileCheckout"},{url:/^checkout\/([^&?]+)[?|&]*(.*)?/,medth:"orderCheckout"},{url:/^category\/([^\/]+)\/([^\/]+)?$/,medth:"categoryHub"},{url:/^category\/([^\/]+)?$/,medth:"category"},{url:/^account\/(.*)/,medth:"accountLayout"}],initialize:function(){var e=this,t=e.regRoutes;t.length&&$.each(t,function(t,o){e.route(o.url,o.medth)}),e.cartCollection=null,e.initLayout=e.bindLayout()},home:function(){return window.location.href=Store.config.webUrl,!1},easter:function(e){return this.navigate("/",{trigger:!0}),!1},mobile:function(e){this.defectT1()},t1:function(e){var t=this,o=0,i=Store.config.defMobileSku.normal;switch(e){case"defect":return t.defectT1(),!1;case"100000001":o=100000001;break;case"3g-16gb-black":o=100000001;break;case"100000002":o=100000002;break;case"3g-32gb-black":o=100000002;break;case"100000201":o=100000201;break;case"4g-32gb-black":o=100000201;break;case"100000202":o=100000202;break;case"4g-32gb-white":o=100000202;break;default:o=i}var r=l.mapNormalT1,a="Smartisan T1";c.findSkuByStock(o,"t1",!0).done(function(e){var o=r[e];o&&o.isSale||(e=i,o=r[e]),t.showView({url:"t1",title:a,mobileScreen:!0,breadcrumb:[{nav:a}],resolve:{title:a,mobileStock:function(){return l.getAllMobilesStock()},pageParams:c.pageNormalParams(o),curMobile:o,pageImages:l.mapPageImagesT1[o.color]},init:function(e,t){var o=new(Store.getView("PageT1"));return o.render(e,t),o}})})},defectT1:function(){var e=this,t=Store.config.defMobileSku.defect,o="Smartisan T1 官方翻新机";c.findSkuByStock(t,"t1",!1).done(function(t){var i=l.mapDefectT1,r=i[t];e.showView({url:"t1",title:o,mobileScreen:!0,breadcrumb:[{nav:o}],resolve:{isDefect:!0,title:o,mobileStock:function(){return l.getAllMobilesStock()},pageParams:c.pageParams(r),curMobile:r,pageImages:l.mapPageImagesT1[r.color]},init:function(e,t){var o=new(Store.getView("PageT1"));return o.render(e,t),o}})})},jianguo:function(e){return window.location.href=Store.config.webUrl+"jianguo?"+e,!1},accessories:function(e,t){return window.location.href=Store.config.webUrl,!1},theme:function(e){var t=this,o=arguments,i={},a=[],n="",s="";switch(e){case"qinghuai":var t=this,c=Store.formatUrlHash(o[1]),l=c.jsonParams.page||1,u=10;n="theme-cover",
s="“情怀”背壳",i={cover:function(){return r.getDoodles({page:l,page_size:u}).then(function(e){return e})}},a=[{nav:s,url:"#/hd/"+e}],t.showView({url:n,title:s,breadcrumb:a,resolve:i,init:function(e,t){var o=new(Store.getView("ThemeCover"));return o.render(e,l,u),o}});break;default:return t.notFound(),!1}},categoryHub:function(e,t){var o=this,t=t||"",i="?id="+e+"&"+t.replace(/^[?|&]+/,"");o.navigate("category/"+i,{trigger:!0})},category:function(e){return/^[?|&]/.test(e)?(window.location.href=Store.config.webUrl+"category?"+e,!1):(/^\d+$/.test(e)?this.navigate("category/?id="+e,{trigger:!0}):this.notFound(),!1)},fiil:function(){return window.location.href=Store.config.webUrl,!1},cart:function(){return window.location.href=Store.config.webUrl+"cart",!1},item:function(e){return window.location.href=Store.config.webUrl+"item/"+e,!1},orderCheckout:function(e,o){var i=this,r=Store.getService("Goods"),s=Store.getService("Discount"),c=t.get(e)||{};if(!c.id)return i.notFound(),!1;c.discount_amount=0|c.discount_amount;var u=[];if(c.mobileGoods&&u.push(c.mobileGoods),c.goods_infos&&u.push(c.goods_infos),c.goods_infos=u.join(","),Store.config.isMobile){var d=n.parseTempOrderParams(c);return void(window.location.href="http://m.store.smartisan.com/#/checkout?"+d)}i.showView({url:"checkout",title:"填写订单",mobileScreen:!0,subNavStyle:"fn-hide",breadcrumb:[{nav:"填写订单"}],pretreatment:function(){var e=[];return $.each(c.goods_infos.split(","),function(t,o){var i=o.split(":");i.pop(),$.each(i,function(t,o){e.push(o)})}),r.getSimpleDetail(e.join(","))},resolve:{curOrder:function(){return c.cdkey_code?(c.cashCard={list:[],max:0},c):s.getCouponByGoods(c.goods_infos).then(function(e){return c.cashCard=e,c})},carts:function(e){var t={postage:0,list:[],total:0,orderTotal:0},o=c.goods_infos.split(","),i=(l.mapCovers,0),r=0;$.each(o,function(o,r){var a=r.split(":"),n=a.shift(),s=a.pop(),c=a;if(e[n]){var l=$.extend({},e[n],{num:0|s});l.subtotal=l.price*l.num,t.total+=l.subtotal,t.orderTotal+=l.subtotal,t.list.push(l),l.isMobile&&c.length&&$.each(c,function(e,o){var i=l.accident&&l.accident.sku==o?$.extend({},l.accident):l.delay&&l.delay.sku==o?$.extend({},l.delay):null;i&&(i.num=l.num,i.subtotal=i.price*i.num,t.total+=i.subtotal,t.orderTotal+=i.subtotal,t.list.push(i))}),l.isDiscount&&(i+=l.num)}}),t.total<Store.config.postageTerm&&(t.postage=Store.config.postage),t.orderTotal=t.total-c.discount_amount;var a=Store.config.goodsDiscount.cover;return Store.config.useGoodsDiscount&&i>=a.num&&(r=a.discount*Math.floor(i/a.num),t.orderTotal-=r),t.discountGoodsTotal=r,t.orderTotal=Store.filter.floatNumber(t.orderTotal+t.postage),t},addresses:function(){return a.getList().then(function(e){var t;return e.list.length?($.each(e.list,function(e,o){return 1==o["default"]?(t=$.extend({},o),!1):void 0}),t=t||e.list[0]):t={},[{curAddress:t,hadList:e.count>0,list:e.list}]})},postageTerm:Store.config.postageTerm},init:function(e,t){var o=new(Store.getView("Checkout"))({collection:Store.getCollection("AddressItem")});return o.render(e,t),o},userRequired:!0})},confirm:function(e){var t=this;t.showView({url:"confirm",title:"现在支付",mobileScreen:!0,breadcrumb:[{nav:"现在支付"}],resolve:{order:function(){return n.getDetail(e).then(function(e){return e?e:(t.notFound(),!1)})}},init:function(e,t){var o=new(Store.getView("Confirm"));return o.render(e),o},userRequired:!0})},orderPayment:function(e,t){var o=this,i=o.isSupport(e),r=i?"支付维修费":"支付订单";return Store.config.useWeixinCheck&&Store.config.isWeixin&&!t?(window.location.href="#/"+Backbone.history.getFragment()+"?showwxpaytitle=1",!1):void o.showView({url:"order-payment",title:r,mobileScreen:!0,pageReload:!0,breadcrumb:[{nav:r}],subNavStyle:"fn-hide",resolve:{order:function(){var t=$.extend({},u.type),r=[].concat(t.platform);return i?s.getDetail(e).then(function(e){return e&&0!=e.repair_price?(Store.config.useWeixinCheck&&r.splice(0,1),t.platform=r,e.paymentOptions=t,e):(o.notFound(),!1)}):n.getSimpleDetail(e).then(function(i){if(i.isClose)return o.navigate("account/orderdetail/"+e,{trigger:!0}),!1;if(i.payComplete)return o.navigate("payment/order/success/"+e,{trigger:!0}),!1;if(!i)return window.location.href="/account/#/order/list",!1;Store.config.useWeixinCheck||r.splice(0,1);var a=i.orderRealTotal;return t.platform=r,t.installment=u.parseInstallment(a),i.paymentOptions=t,i})},weixin:function(){return Store.config.isWeixin?u.canWeixinCheck().done(function(e){if(!e.open_id){{Store.config.getWeixinUrl+"custom="+encodeURIComponent(window.location.href)}return window.location.href=Store.config.getWeixinUrl+"custom="+encodeURIComponent(window.location.href),!1}return{ok:1}}):{ok:1}}},init:function(e,t){var o=new(Store.getView("Payment"));return o.render(e,t),o},userRequired:!0})},accountLayout:function(e){var e=e||"",t=e.split("/"),o=t.shift(),i=t.join("/");switch(o){case"userinfo":window.location.href="/account/#/information";break;case"orderdetail":window.location.href="/account/#/order/detail/"+i;break;case"supportdetail":window.location.href="/account/#/support/detail/"+i;break;case"preorder":window.location.href="/account/#/order/list";break;case"order":window.location.href="/account/#/order/list";break;case"support":window.location.href="/account/#/support/list";break;case"address":window.location.href="/account/#/address/list";break;default:window.location.href="/account/#/order/list"}},warrantyAgreementProxy:function(){this.navigate("insurance/information",{trigger:!0})},warrantyInformation:function(){var e=this;return Store.config.isMobile?void(window.location.href="http://m.store.smartisan.com/#/insurance/information"):void e.showView({url:"warranty-information",title:"意外保修服务",navCategory:"warranty",init:function(e,t){var o=new(Store.getView("WarrantyBuying"));o.render(e)}})},warrantyBuying:function(){var e=this;return Store.config.isMobile?void(window.location.href="http://m.store.smartisan.com/#/insurance/buying"):void e.showView({url:"warranty-buying",title:"购买保修服务",navCategory:"warranty",resolve:{user:function(){return o.getInfo().fail(function(){o.openLogin()})}},init:function(e,t){var o=new(Store.getView("WarrantyBuying"));o.render(e)},userRequired:!0})},mobileCdkey:function(e){return window.location.href=Store.config.webUrl+"cdkey",!1},delay:function(){var e=this,t=t||"",o="延长保修服务兑换",i="延长保修服务兑换";return Store.config.isMobile?void(window.location.href="http://m.store.smartisan.com/#/delay"):void e.showView({url:"cdkey-delay",title:o,mobileScreen:!0,breadcrumb:[{nav:i}],resolve:{title:o,type:t},init:function(e,t){var o=new(Store.getView("CdkeyDelay"));return o.render(e,t),o}})},paymentResult:function(e,t,o){var r=this;r.showView({url:"payment-result",title:"支付结果",mobileScreen:!0,breadcrumb:[{nav:"支付结果"}],resolve:{type:function(){switch(e){case"preorder":return{listLabel:"我的订单",orderName:"订单",paymentLabel:"订单",url:"/account/#/order/list",isOrder:!0};case"order":return{listLabel:"我的订单",orderName:"订单",paymentLabel:"订单",url:"/account/#/order/list",isOrder:!0};case"support":return{listLabel:"售后服务",orderName:"服务单",paymentLabel:"维修费",url:"/account/#/support/list",isSupport:!0};default:return r.notFound(),!1}},mobile:function(){return l.mapPhones[100007201]},carts:function(){return i.getFeatureList("4")},order:function(){return o?n.getSimpleDetail(o).then(function(e){return e?e:(r.notFound(),!1)}):{}},status:function(){switch(t){case"success":return{success:!0};case"error":return{success:!1};default:return r.notFound(),!1}},weiboShare:"appkey=&title="+encodeURIComponent("锤子科技发布的@坚果手机 ，搭载极富易用性和人性化的 Smartisan OS 操作系统，内置Qualcomm® 骁龙™615处理器，5.5吋1080p全高清大屏、双卡双待，支持移动或联通两种4G模式。另有七彩背壳随心选购。我已成功购买，推荐你也来预约＃坚果手机＃ ：")+"&url="+encodeURIComponent("http://buy.smartisan.com")+"&pic="+CDN_HOST+"img/weibo-share.png?"+TIMESTAMP},init:function(e,t){var o=new(Store.getView("PaymentResult"));return o.render(e,t),o}})},recycle:function(){var e=this,t=t||"",i="手机回收置换服务";return Store.config.isMobile?void(window.location.href="http://m.store.smartisan.com/#/huanxin"):void e.showView({url:"recycle",title:i,mobileScreen:!1,breadcrumb:[],subNavStyle:"black-header",resolve:{title:i,type:t,isLogin:o.isLoggedIn?1:0},init:function(e,t){var o=new(Store.getView("Recycle"));return o.render(e,t),o}})},notFound:function(){return"#/error/500"==window.location.hash?!1:void this.navigate("error/404",{trigger:!0})},error:function(e){var t=this,o=Store.config.serviceError[e]?Store.config.serviceError[e]:Store.config.serviceError[404];t.showView({url:"service-status",title:o.title,mobileScreen:!0,breadcrumb:[{nav:o.title}],resolve:{status:o},init:function(e,t){var o=new(Store.getView("ServiceStatus"));return o.render(e),o}})},setTitle:function(e){document.title=e},setFooterCopyright:function(){if($(".copyright-time")){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,i=2016;2015==t&&12==o&&(i=2015),$(".copyright-time").html(i)}},bindLayout:function(){var t=this;return t.initLayout?!1:(t.initLayout=!0,Store.getView("Layout"),$(".wrapper").on("click",".js-history-back",function(){history.back(-1)}),$("#returnTop").on("click",function(){$("html,body").animate({scrollTop:$("body").offset().top},{queue:!1,duration:1e3,easing:"easeOutQuart"})}),$(".wrapper").on("click",".white-btn-menu",function(e){var t=$(this);return t.hasClass("white-btn-menu-on")?!1:(t.toggleClass("white-btn-menu-on",!0),void t.find(".menu-list").css({opacity:0}).animate({opacity:1},{duration:200,easing:"easeOutQuart",complete:function(){$(document).one("click",function(){t.find(".menu-list").animate({opacity:0},{duration:200,easing:"easeOutQuart",complete:function(){t.toggleClass("white-btn-menu-on",!1)}})})}}))}),$(".wrapper").on("click",".gray-btn-menu",function(e){var t=$(this);t.hasClass("gray-btn-menu-on")?(t.toggleClass("gray-btn-menu-on",!1),$(document).off("click.openMenu")):(t.toggleClass("gray-btn-menu-on",!0),setTimeout(function(){$(document).on("click.openMenu",function(){t.toggleClass("gray-btn-menu-on",!1),$(document).off("click.openMenu")})},50))}),$(".wrapper").on("click",".online-services",function(t){t.preventDefault();var o=$(t.currentTarget),i=Store.config.isMobile?"在线咨询":"全站在线咨询";o.hasClass("js-t1-question")&&(i="手机页在线咨询"),e.openLive800Diag()}),$("[show-weixin-code]").on("click",function(t){if($(t.target).hasClass("js-weixin")){var o=this;e.toggleWeixinCode(o)}}),$("[show-language-menu]").on("click",function(){var t=this;e.toggleLanguageMenu(t)}),t.setContentHeight(),t.mainCart=new(Store.getView("CartMain"))({el:$("#js-main-cart-panel"),collection:Store.getCollection("Cart",[])}),t.mainCart.render(),t.subNav=new(Store.getView("SubNav")),t.subNav.render(),o.isLogin(!0))},showView:function(e,t){var i,r,a=this,n=e.tempData||{},s=e.container||Store.config.layoutContainer,c=ct.get(e.url,!0),l={key:[],value:[]},u=(e.breadcrumb,Store.config.pageLoading);if($("#returnTop").toggleClass("fn-hide",!!e.hideReturn),e.hideCart?a.mainCart.$el.hide():a.mainCart.$el.show(),e.hashParams&&!e.isHub&&!t){var d=Store.formatUrlToParams().base,g=Store.formatUrlHash(e.hashParams);if(e.hashCache={base:d,updateParams:g},Store.currentView.hashCache&&Store.currentView.hashCache.base==d&&Store.currentView.viewCache&&"function"==typeof Store.currentView.viewCache.updateView){var p=Store.currentView.hashCache.updateParams;return Store.currentView.hashCache=e.hashCache,Store.currentView.viewCache.updateView(Store.formatHashAction(p,g)),!1}}Store.currentView.viewCache&&"function"==typeof Store.currentView.viewCache.remove&&Store.currentView.viewCache.remove(),Store.currentView=e,Store.reloadView=function(){a.showView(e,!0)},a.initLayout.always(function(){Store.getPlugin("Dialog").closeAll(),i=c?Store.proxyDefer(c):ct.get(e.url),a.unbindLayout(),s.off().empty(),u.show();var t=Store.isFunction(e.pretreatment)?e.pretreatment():Store.proxyDefer(!0);t.always(function(t,c,d){return t===!1?!1:(e.resolve&&$.each(e.resolve,function(e,o){l.key.push(e);var i=Store.isFunction(o)?o(t,c,d):o;l.value.push("object"==typeof i&&"function"==typeof i.done?i:Store.proxyDefer([i]))}),void $.when.apply(jQuery,l.value).done(function(){return a.subNav.toggleStyle(e.subNavStyle),a.subNav.selectCategory(e.navCategory),e.userRequired&&!o.isLoggedIn?(o.openLogin(),!1):($.each(arguments,function(e,t){return n[l.key[e]]=t&&t.constructor==Array?t[0]:t,n[l.key[e]]===!1?(r=!0,!1):void 0}),r?!1:(e.tempData=n,void i.always(function(t){$(document).scrollTop(0),document.title=e.title+" - Smartisan"}).done(function(t,o,i){Store.config.isMobile&&(e.mobileScreen?(window.innerWidth!=screen.width&&$('[rel="stylesheet"][media]').attr("media",""),$('meta[name="viewport"]').attr("content","width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no")):(window.innerWidth!=screen.width&&$('[rel="stylesheet"][media]').attr("media","only screen and (max-device-width:800px) and (-webkit-min-device-pixel-ratio:2)"),$('meta[name="viewport"]').attr("content",""))),u.hide(),a.setFooterCopyright(),s.html(ct.compile(t,n)),e.html=t,e.$page=s.find(".content"),Store.currentView=e,"function"==typeof e.init&&(Store.currentView.viewCache=e.init(e,n))}).fail(function(e,t,o){})))}).fail(function(e,t){return e?void(10004!=e&&1e3!=e&&7e4!=e&&(window.location.href="#/")):!1}))})})},unbindLayout:function(){var e=this;$.each(Store.loop,function(e,t){clearInterval(Store.loop[e])}),e.subNav.closeMenu(),$(window).off("scroll"),$(window).off("resize"),Store.config.isMobile||($(window).scroll(function(){$(window).scrollTop()>0?$("#returnTop").animate({bottom:"10px"},{queue:!1,duration:200}):$("#returnTop").animate({bottom:"-40px"},{queue:!1,duration:200})}),$(window).on("resize",function(){e.setContentHeight()}))},initBreadcrumb:function(e){{var t=[{nav:"在线商城",url:"#/"}];ct.get("tempMainBreadcrumb",!0)}e=t.concat(e)},isSupport:function(e){var t=/^(\d)/,o=(e+"").match(t);return o?5==o[1]?!0:!1:void 0},setContentHeight:function(){var e=$(window).height()-487;$("#main").css("min-height",e)}}));Store.Router=new d,Backbone.history.start({})});